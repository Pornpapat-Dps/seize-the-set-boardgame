<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Seize The Set Boardgame - ‡πÄ‡∏Å‡∏°‡∏¢‡∏∂‡∏î‡∏Ñ‡∏£‡∏≠‡∏á‡πÄ‡∏ã‡∏ï</title>
<style>
  :root {
    /* --primary: #ff4f9a; */
    --secondary: #7c3aed;
    --dark: #1f2937;
    --light: #f8fafc;
    --success: #10b981;
    --warning: #f59e0b;
    --danger: #ef4444;
  }

  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
    color: var(--dark);
  }

  .container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 20px;
  }
  
  /* Responsive ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏Ç‡∏ô‡∏≤‡∏î‡∏ï‡πà‡∏≤‡∏á‡πÜ */
  @media (max-width: 768px) {
    .container {
      padding: 10px;
    }
  }

  .header {
    text-align: center;
    background: white;
    border-radius: 15px;
    padding: 30px;
    margin-bottom: 30px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
  }

  .header h1 {
    font-size: 2.5rem;
    background: linear-gradient(45deg, var(--primary), var(--secondary));
    -webkit-background-clip: text;
    background-clip: text;
    -webkit-text-fill-color: transparent;
    margin-bottom: 10px;
  }
  
  /* Responsive Header */
  @media (max-width: 768px) {
    .header {
      padding: 20px;
      margin-bottom: 20px;
    }
    
    .header h1 {
      font-size: 1.8rem;
    }
  }
  
  @media (max-width: 480px) {
    .header h1 {
      font-size: 1.5rem;
    }
  }

  .game-area {
    display: grid;
    grid-template-columns: 1fr 400px;
    gap: 30px;
    margin-bottom: 30px;
  }
  
  /* Responsive Game Area */
  @media (max-width: 1024px) {
    .game-area {
      grid-template-columns: 1fr 350px;
      gap: 20px;
    }
  }
  
  @media (max-width: 768px) {
    .game-area {
      grid-template-columns: 1fr;
      gap: 20px;
      margin-bottom: 20px;
    }
  }

  .board-section {
    background: white;
    border-radius: 15px;
    padding: 25px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
  }

  .control-panel {
    background: white;
    border-radius: 15px;
    padding: 25px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
  }
  
  /* Responsive Panels */
  @media (max-width: 768px) {
    .board-section, .control-panel {
      padding: 15px;
    }
  }
  
  @media (max-width: 480px) {
    .board-section, .control-panel {
      padding: 12px;
    }
  }

  .card-info-panel {
    background: white;
    border-radius: 15px;
    padding: 25px;
    margin-bottom: 30px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
  }

  .toggle-card-info {
    background: var(--primary);
    color: white;
    border: none;
    border-radius: 10px;
    padding: 12px 20px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s ease;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 10px;
    width: 100%;
    justify-content: center;
  }

  .toggle-card-info:hover {
    background: var(--secondary);
    transform: translateY(-2px);
  }

  .card-info-content {
    display: none;
    animation: slideDown 0.3s ease;
  }

  .card-info-content.show {
    display: block;
  }

  @keyframes slideDown {
    from {
      opacity: 0;
      transform: translateY(-20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .card-info-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 30px;
  }

  .card-category {
    background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
    border-radius: 10px;
    padding: 20px;
    border-left: 4px solid var(--primary);
  }

  .card-category h4 {
    color: var(--primary);
    margin-bottom: 15px;
    font-size: 1.2rem;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .card-list {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
  }

  .card-item {
    background: white;
    border-radius: 8px;
    padding: 12px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border: 1px solid #e2e8f0;
    transition: all 0.3s ease;
  }

  .card-item:hover {
    border-color: var(--primary);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  }

  .card-name {
    font-weight: 600;
    color: var(--dark);
  }

  .card-count {
    background: var(--primary);
    color: white;
    border-radius: 20px;
    padding: 4px 12px;
    font-size: 0.9rem;
    font-weight: bold;
  }

  .total-cards {
    text-align: center;
    margin-top: 20px;
    padding: 15px;
    background: linear-gradient(45deg, var(--primary), var(--secondary));
    color: white;
    border-radius: 10px;
    font-weight: bold;
    font-size: 1.1rem;
  }

  .game-board {
    display: grid;
    grid-template-columns: 40px repeat(8, 60px);
    grid-template-rows: 40px repeat(8, 60px);
    gap: 3px;
    margin: 20px auto;
    background: var(--dark);
    padding: 10px;
    border-radius: 10px;
    max-width: 100%;
    overflow-x: auto;
  }
  
  /* Responsive Game Board */
  @media (max-width: 768px) {
    .game-board {
      grid-template-columns: 30px repeat(8, 45px);
      grid-template-rows: 30px repeat(8, 45px);
      gap: 2px;
      padding: 8px;
    }
  }
  
  @media (max-width: 480px) {
    .game-board {
      grid-template-columns: 25px repeat(8, 35px);
      grid-template-rows: 25px repeat(8, 35px);
      gap: 1px;
      padding: 6px;
    }
  }

  .cell {
    display: flex;
    align-items: center;
    justify-content: center;
    background: white;
    border-radius: 5px;
    font-weight: bold;
    font-size: 0.9rem;
    position: relative;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .cell.header {
    background: var(--dark);
    color: white;
    font-size: 0.8rem;
  }
  
  /* Responsive Cell */
  @media (max-width: 768px) {
    .cell {
      font-size: 0.7rem;
    }
    
    .cell.header {
      font-size: 0.6rem;
    }
  }
  
  @media (max-width: 480px) {
    .cell {
      font-size: 0.6rem;
    }
    
    .cell.header {
      font-size: 0.5rem;
    }
  }

  .cell.game-cell {
    min-height: 60px;
    border: 2px solid transparent;
  }

  .cell.game-cell:hover {
    border-color: var(--warning);
    transform: scale(1.05);
  }

  .chip {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    color: white;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
  }

  .chip.black {
    background: linear-gradient(145deg, #374151, #111827);
    box-shadow: inset 2px 2px 5px rgba(255,255,255,0.2), inset -2px -2px 5px rgba(0,0,0,0.5);
  }

  .chip.white {
    background: linear-gradient(145deg, #f9fafb, #e5e7eb);
    color: var(--dark);
    box-shadow: inset 2px 2px 5px rgba(255,255,255,0.8), inset -2px -2px 5px rgba(0,0,0,0.1);
  }
  
  /* Responsive Chip */
  @media (max-width: 768px) {
    .chip {
      width: 30px;
      height: 30px;
      font-size: 0.8rem;
    }
    
    .cell.game-cell {
      min-height: 45px;
    }
  }
  
  @media (max-width: 480px) {
    .chip {
      width: 25px;
      height: 25px;
      font-size: 0.7rem;
    }
    
    .cell.game-cell {
      min-height: 35px;
    }
  }

  .score-display {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: linear-gradient(135deg, #f0f4f8, #e2e8f0);
    padding: 20px;
    border-radius: 10px;
    margin-bottom: 20px;
  }

  .player-score {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .player-score .chip {
    width: 30px;
    height: 30px;
    font-size: 0.8rem;
  }

  .turn-info {
    background: var(--primary);
    color: white;
    padding: 15px;
    border-radius: 10px;
    text-align: center;
    margin-bottom: 20px;
    font-weight: bold;
    font-size: 1.1rem;
  }

  .turn-info.black-turn {
    background: linear-gradient(135deg, #374151, #111827);
  }

  .turn-info.white-turn {
    background: linear-gradient(135deg, #f9fafb, #e5e7eb);
    color: var(--dark);
  }

  .current-player-indicator {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    font-size: 1.2rem;
  }

  .actions {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
    margin-bottom: 20px;
  }

  .btn {
    padding: 12px 20px;
    border: none;
    border-radius: 8px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 0.9rem;
  }
  
  /* Responsive Buttons */
  @media (max-width: 768px) {
    .actions {
      grid-template-columns: 1fr;
      gap: 8px;
    }
    
    .btn {
      padding: 10px 16px;
      font-size: 0.8rem;
    }
  }
  
  @media (max-width: 480px) {
    .btn {
      padding: 8px 12px;
      font-size: 0.75rem;
    }
  }

  .btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
  }

  .btn.primary {
    background: var(--primary);
    color: white;
  }

  .btn.secondary {
    background: var(--secondary);
    color: white;
  }

  .btn.success {
    background: var(--success);
    color: white;
  }

  .btn.warning {
    background: var(--warning);
    color: white;
  }

  .btn.danger {
    background: var(--danger);
    color: white;
  }

  .btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: none;
  }

  .hand {
    background: #f8fafc;
    border-radius: 10px;
    padding: 15px;
    margin-bottom: 20px;
  }

  .hand h4 {
    margin-bottom: 10px;
    color: var(--dark);
  }

  .cards {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
  }

  .card {
    background: white;
    border: 2px solid var(--dark);
    border-radius: 8px;
    padding: 8px 12px;
    font-size: 0.8rem;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
  }

  .card .card-details {
    font-size: 0.7rem;
    color: #666;
    margin-top: 4px;
    line-height: 1.2;
  }

  .card:hover {
    background: var(--primary);
    color: white;
    transform: scale(1.05);
  }
  
  /* Responsive Cards */
  @media (max-width: 768px) {
    .hand {
      padding: 12px;
    }
    
    .cards {
      gap: 6px;
    }
    
    .card {
      padding: 6px 10px;
      font-size: 0.7rem;
    }
    
    .card .card-details {
      font-size: 0.6rem;
    }
  }
  
  @media (max-width: 480px) {
    .hand {
      padding: 10px;
    }
    
    .card {
      padding: 4px 8px;
      font-size: 0.65rem;
    }
    
    .card .card-details {
      font-size: 0.55rem;
    }
  }

  .card.set {
    border-color: var(--success);
  }

  .card.marker {
    border-color: var(--secondary);
  }

  .card.selected {
    background: var(--warning);
    color: white;
  }

  .game-log {
    background: #f8fafc;
    border-radius: 10px;
    padding: 15px;
    height: 200px;
    overflow-y: auto;
  }

  .log-entry {
    padding: 5px 0;
    border-bottom: 1px solid #e2e8f0;
    font-size: 0.9rem;
  }

  .modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.7);
    z-index: 1000;
  }

  .modal-content {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: white;
    border-radius: 15px;
    padding: 30px;
    min-width: 400px;
    box-shadow: 0 20px 60px rgba(0,0,0,0.3);
  }

  .modal h3 {
    margin-bottom: 20px;
    color: var(--dark);
  }

  .card-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
    margin-bottom: 20px;
  }

  .status-bar {
    background: linear-gradient(135deg, #e2e8f0, #cbd5e1);
    padding: 10px 15px;
    border-radius: 8px;
    margin-bottom: 15px;
    font-size: 0.9rem;
  }

  @media (max-width: 1200px) {
    .game-area {
      grid-template-columns: 1fr;
    }
    
    .game-board {
      grid-template-columns: 30px repeat(8, 45px);
      grid-template-rows: 30px repeat(8, 45px);
    }
    
    .cell.game-cell {
      min-height: 45px;
    }
    
    .chip {
      width: 30px;
      height: 30px;
    }
  }

  /* Color Selection Modal */
  .color-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 1000;
  }

  .color-modal-content {
    background: white;
    border-radius: 20px;
    padding: 40px;
    max-width: 500px;
    width: 90%;
    text-align: center;
    box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    animation: modalSlideIn 0.3s ease;
  }

  .color-selection {
    display: flex;
    gap: 30px;
    justify-content: center;
    margin: 30px 0;
  }
  
  /* Responsive Modal */
  @media (max-width: 768px) {
    .color-modal-content {
      padding: 25px;
      width: 95%;
    }
    
    .color-selection {
      gap: 20px;
      margin: 20px 0;
    }
  }
  
  @media (max-width: 480px) {
    .color-modal-content {
      padding: 20px;
    }
    
    .color-selection {
      flex-direction: column;
      gap: 15px;
      align-items: center;
    }
  }

  .color-option {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 15px;
    padding: 30px 25px;
    border: 3px solid transparent;
    border-radius: 15px;
    cursor: pointer;
    transition: all 0.3s ease;
    background: #f8fafc;
  }

  .color-option:hover {
    border-color: var(--primary);
    transform: translateY(-5px);
    box-shadow: 0 10px 30px rgba(0,0,0,0.15);
  }

  .color-option.selected {
    border-color: var(--success);
    background: #f0fdf4;
  }

  .color-chip {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 3rem;
    box-shadow: 0 5px 20px rgba(0,0,0,0.2);
  }

  .color-chip.black {
    background: #1f2937;
    color: white;
  }

  .color-chip.white {
    background: white;
    color: #1f2937;
    border: 2px solid #e2e8f0;
  }

  @keyframes modalSlideIn {
    from {
      opacity: 0;
      transform: scale(0.8) translateY(-50px);
    }
    to {
      opacity: 1;
      transform: scale(1) translateY(0);
    }
  }

  /* Game Mode Selection Styles */
  .game-mode-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    backdrop-filter: blur(5px);
  }

  .game-mode-modal-content {
    background: white;
    padding: 40px;
    border-radius: 20px;
    text-align: center;
    max-width: 600px;
    width: 90%;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
    animation: modalSlideIn 0.3s ease-out;
  }

  .mode-selection {
    display: flex;
    gap: 30px;
    justify-content: center;
    margin-top: 30px;
  }

  .mode-option {
    background: #f8f9fa;
    border: 3px solid transparent;
    border-radius: 15px;
    padding: 30px 20px;
    cursor: pointer;
    transition: all 0.3s ease;
    text-align: center;
    min-width: 200px;
  }

  .mode-option:hover {
    border-color: var(--primary);
    transform: translateY(-5px);
    box-shadow: 0 10px 25px rgba(59, 130, 246, 0.2);
    background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
  }

  .mode-icon {
    font-size: 4rem;
    margin-bottom: 15px;
  }

  .mode-option h3 {
    margin: 10px 0;
    color: var(--primary);
    font-size: 1.3rem;
  }

  .mode-option p {
    color: #666;
    font-size: 0.9rem;
    line-height: 1.4;
  }
  
  /* Responsive Game Mode Modal */
  @media (max-width: 768px) {
    .game-mode-modal-content {
      padding: 25px;
      width: 95%;
    }
    
    .mode-selection {
      gap: 20px;
      margin-top: 20px;
    }
    
    .mode-option {
      min-width: 150px;
      padding: 20px 15px;
    }
    
    .mode-icon {
      font-size: 3rem;
    }
    
    .mode-option h3 {
      font-size: 1.1rem;
    }
  }
  
  @media (max-width: 480px) {
    .game-mode-modal-content {
      padding: 20px;
    }
    
    .mode-selection {
      flex-direction: column;
      gap: 15px;
      align-items: center;
    }
    
    .mode-option {
      width: 100%;
      max-width: 250px;
      padding: 15px;
    }
    
    .mode-icon {
      font-size: 2.5rem;
    }
  }
</style>
</head>
<body>
  <!-- Game Mode Selection Modal -->
  <div id="gameModeModal" class="game-mode-modal" style="display: none;">
    <div class="game-mode-modal-content">
      <h2 style="margin-bottom: 20px; color: var(--primary);">üéÆ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏´‡∏°‡∏î‡πÄ‡∏Å‡∏°</h2>
      <p style="margin-bottom: 30px; color: #666;">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô‡πÅ‡∏ö‡∏ö‡πÑ‡∏´‡∏ô</p>
      
      <div class="mode-selection">
        <div class="mode-option" onclick="selectGameMode('ai')">
          <div class="mode-icon">ü§ñ</div>
          <h3>‡πÄ‡∏•‡πà‡∏ô‡∏Å‡∏±‡∏ö AI</h3>
          <p>‡πÄ‡∏•‡πà‡∏ô‡∏Å‡∏±‡∏ö‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå<br>1 ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô vs AI</p>
        </div>
        
        <div class="mode-option" onclick="selectGameMode('friend')">
          <div class="mode-icon">üë•</div>
          <h3>‡πÄ‡∏•‡πà‡∏ô‡∏Å‡∏±‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô</h3>
          <p>‡πÄ‡∏•‡πà‡∏ô 2 ‡∏Ñ‡∏ô‡∏ö‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß<br>‡∏ú‡∏•‡∏±‡∏î‡∏Å‡∏±‡∏ô‡πÄ‡∏•‡πà‡∏ô</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Color Selection Modal -->
  <div id="colorModal" class="color-modal" style="display: none;">
    <div class="color-modal-content">
      <h2 id="colorModalTitle" style="margin-bottom: 20px; color: var(--primary);">üéØ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏µ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h2>
      <p id="colorModalDesc" style="margin-bottom: 30px; color: #666;">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏µ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô (‡∏™‡∏µ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô AI)</p>
      
      <div class="color-selection">
        <div class="color-option" data-color="black" onclick="selectColor('black')">
          <div class="color-chip black">‚ö´</div>
          <h3>‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏î‡∏≥</h3>
          <p style="color: #666; font-size: 0.9rem;">‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏•‡πà‡∏ô‡∏™‡∏µ‡∏î‡∏≥<br>AI ‡πÄ‡∏•‡πà‡∏ô‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß</p>
        </div>
        
        <div class="color-option" data-color="white" onclick="selectColor('white')">
          <div class="color-chip white">‚ö™</div>
          <h3>‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏Ç‡∏≤‡∏ß</h3>
          <p style="color: #666; font-size: 0.9rem;">‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏•‡πà‡∏ô‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß<br>AI ‡πÄ‡∏•‡πà‡∏ô‡∏™‡∏µ‡∏î‡∏≥</p>
        </div>
      </div>
      
      <button id="confirmColorBtn" class="btn primary" disabled onclick="confirmColorSelection()">
        ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°
      </button>
    </div>
  </div>

  <div class="container">
    <div class="header">
      <h1>üéØ Seize The Set Boardgame</h1>
      <p>‡πÄ‡∏Å‡∏°‡∏¢‡∏∂‡∏î‡∏Ñ‡∏£‡∏≠‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ã‡∏ï - ‡∏ú‡∏•‡∏±‡∏î‡∏Å‡∏±‡∏ô‡πÄ‡∏•‡πà‡∏ô 20 ‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô</p>
    </div>

    <div class="card-info-panel">
      <button class="toggle-card-info" onclick="toggleCardInfo()">
        <span id="toggle-icon">üëÅÔ∏è</span>
        <span id="toggle-text">‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πå‡∏î</span>
      </button>
      
      <div class="card-info-content" id="card-info-content">
        <h3 style="text-align: center; margin-bottom: 25px; color: var(--primary);">üìö ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÉ‡∏ô‡πÄ‡∏Å‡∏°</h3>
        <div class="card-info-grid">
        <div class="card-category">
          <h4>üé¥ ‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏ã‡∏ï (Set Cards)</h4>
          <div class="card-list">
            <div class="card-item" title="‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏Ç‡∏ô‡∏≤‡∏î 2√ó2 ‡∏ä‡πà‡∏≠‡∏á - ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡πÄ‡∏Å‡∏°">
              <span class="card-name">‡πÄ‡∏ã‡∏ï 2√ó2</span>
              <span class="card-count">49 ‡πÉ‡∏ö</span>
            </div>
            <div class="card-item" title="‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏Ç‡∏ô‡∏≤‡∏î 4√ó4 ‡∏ä‡πà‡∏≠‡∏á - ‡∏ó‡∏£‡∏á‡∏û‡∏•‡∏±‡∏á‡πÅ‡∏ï‡πà‡∏´‡∏≤‡∏¢‡∏≤‡∏Å">
              <span class="card-name">‡πÄ‡∏ã‡∏ï 4√ó4</span>
              <span class="card-count">4 ‡πÉ‡∏ö</span>
            </div>
            <div class="card-item" title="‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢: ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ó‡∏µ‡πà‡πÄ‡∏•‡πá‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏ù‡∏±‡πà‡∏á‡∏ï‡∏£‡∏á‡∏Ç‡πâ‡∏≤‡∏°">
              <span class="card-name">Empty Set ‚àÖ</span>
              <span class="card-count">10 ‡πÉ‡∏ö</span>
            </div>
          </div>
          <div class="total-cards">
            ‡∏£‡∏ß‡∏°‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏ã‡∏ï: 63 ‡πÉ‡∏ö | 
            <span id="remaining-set-cards">‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÉ‡∏ô‡πÄ‡∏î‡πá‡∏Ñ: ?</span>
          </div>
        </div>

        <div class="card-category">
          <h4>‚ö° ‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢ (Marker Cards)</h4>
          <div class="card-list">
            <div class="card-item" title="‡∏£‡∏ß‡∏°‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà + ‡∏¢‡∏∂‡∏î‡∏Ñ‡∏£‡∏≠‡∏á‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏ï‡∏¥‡∏î‡∏Å‡∏±‡∏ô (‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô 16+ ‡∏´‡πâ‡∏≤‡∏°‡πÉ‡∏ä‡πâ)">
              <span class="card-name">Union ‚à™</span>
              <span class="card-count">4 ‡πÉ‡∏ö</span>
            </div>
            <div class="card-item" title="‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡∏ó‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡∏Å‡∏±‡∏ô">
              <span class="card-name">Intersection ‚à©</span>
              <span class="card-count">12 ‡πÉ‡∏ö</span>
            </div>
            <div class="card-item" title="‡∏•‡∏ö‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏ù‡∏±‡πà‡∏á‡∏ï‡∏£‡∏á‡∏Ç‡πâ‡∏≤‡∏° (‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà)">
              <span class="card-name">Difference \</span>
              <span class="card-count">12 ‡πÉ‡∏ö</span>
            </div>
            <div class="card-item" title="‡∏ó‡∏∏‡∏Å‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏Å‡πÄ‡∏ß‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏ã‡∏ï (‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô 10+)">
              <span class="card-name">Complement ·∂ú</span>
              <span class="card-count">4 ‡πÉ‡∏ö</span>
            </div>
          </div>
          <div class="total-cards">
            ‡∏£‡∏ß‡∏°‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢: 32 ‡πÉ‡∏ö | 
            <span id="remaining-marker-cards">‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÉ‡∏ô‡πÄ‡∏î‡πá‡∏Ñ: ?</span>
          </div>
        </div>
        
        <div style="margin-top: 25px; padding: 20px; background: linear-gradient(135deg, #fff7ed 0%, #fed7aa 100%); border-radius: 10px; border-left: 4px solid var(--warning);">
          <h4 style="color: var(--warning); margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
            ‚ö†Ô∏è ‡∏Å‡∏é‡∏û‡∏¥‡πÄ‡∏®‡∏©
          </h4>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; font-size: 0.9rem;">
            <div>
              <strong>üîÑ Complement Cards:</strong><br>
              ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô‡∏ó‡∏µ‡πà 10 ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
            </div>
            <div>
              <strong>‚ö° Union Cards:</strong><br>
              ‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô 16+ ‡∏´‡∏≤‡∏Å‡∏à‡∏±‡πà‡∏ß‡πÑ‡∏î‡πâ‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏¥‡πâ‡∏á‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏±‡πà‡∏ß‡πÉ‡∏´‡∏°‡πà
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="game-area">
      <div class="board-section">
        <h3>üé≤ ‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô‡πÄ‡∏Å‡∏° 8x8</h3>
        <div id="gameBoard" class="game-board"></div>
      </div>

      <div class="control-panel">
        <div class="score-display">
          <div class="player-score">
            <div class="chip black">‚ö´</div>
            <div>
              <div>‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏î‡∏≥</div>
              <div id="blackScore">0 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</div>
            </div>
          </div>
          <div class="player-score">
            <div class="chip white">‚ö™</div>
            <div>
              <div>‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏Ç‡∏≤‡∏ß</div>
              <div id="whiteScore">0 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</div>
            </div>
          </div>
        </div>

        <div id="turnInfo" class="turn-info">
          ‡πÄ‡∏Å‡∏°‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°
        </div>

        <div class="status-bar">
          <div id="gameStatus">‡∏Å‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô</div>
        </div>

        <div class="actions">
          <button id="drawSetBtn" class="btn success" disabled>‡∏à‡∏±‡πà‡∏ß‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏ã‡∏ï</button>
          <button id="drawMarkerBtn" class="btn secondary" disabled>‡∏à‡∏±‡πà‡∏ß‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢</button>
          <button id="placeCardsBtn" class="btn primary" disabled>‡∏•‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î</button>
          <button id="discardBtn" class="btn warning" disabled>‡∏ó‡∏¥‡πâ‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î</button>
          <button id="skipTurnBtn" class="btn danger" disabled>‡∏Ç‡πâ‡∏≤‡∏°/‡∏à‡∏ö‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô</button>
          <button id="newGameBtn" class="btn primary">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡πÉ‡∏´‡∏°‡πà</button>
        </div>

        <div class="hand">
          <h4>üÉè ‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÉ‡∏ô‡∏°‡∏∑‡∏≠</h4>
          <p style="font-size: 0.8rem; color: #666; margin-bottom: 10px;">
            üí° <strong>‡∏ß‡∏¥‡∏ò‡∏µ‡πÄ‡∏•‡πà‡∏ô:</strong> 1Ô∏è‚É£ ‡∏à‡∏±‡πà‡∏ß‡∏Å‡∏≤‡∏£‡πå‡∏î ‚Üí 2Ô∏è‚É£ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏ä‡πâ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå (‡∏•‡∏á/‡∏ó‡∏¥‡πâ‡∏á/‡∏Ç‡πâ‡∏≤‡∏°) ‚Üí ‡∏à‡∏ö‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ<br>
            üéØ <strong>‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢:</strong> Union=‡∏£‡∏ß‡∏°+‡∏ï‡∏¥‡∏î‡∏Å‡∏±‡∏ô, Intersection=‡∏ó‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô, Difference=‡∏•‡∏ö‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏ù‡∏±‡πà‡∏á‡∏ï‡∏£‡∏á‡∏Ç‡πâ‡∏≤‡∏°(‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà)!
          </p>
          <div id="playerHand" class="cards"></div>
        </div>

        <div class="game-log">
          <h4>üìã ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô</h4>
          <div id="gameLog"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡πå‡∏î -->
  <div id="cardModal" class="modal">
    <div class="modal-content">
      <h3 id="modalTitle">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡πå‡∏î</h3>
      <div id="cardSelection" class="card-grid"></div>
      <div style="text-align: right;">
        <button id="modalCancel" class="btn danger" style="margin-right: 10px;">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        <button id="modalConfirm" class="btn success">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
      </div>
    </div>
  </div>

<script>
// ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÄ‡∏Å‡∏°
let gameState = {
  phase: 'waiting', // waiting, pregame, playing, finished
  turnPhase: 'draw', // draw, action
  turn: 0,
  currentPlayer: 'black', // black, white
  players: {
    black: { hand: [], score: 0, tokens: 0 },
    white: { hand: [], score: 0, tokens: 0 }
  },
  board: {},
  deckSet: [],
  deckMarker: [],
  drawnThisTurn: false,
  cardsPlacedThisTurn: { set: false, marker: false },
  selectedCards: []
};

// ‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏ã‡∏ï 2x2 (49 ‡πÉ‡∏ö)
const generate2x2Cards = () => {
  const cards = [];
  const letters = ['A','B','C','D','E','F','G','H'];
  
  for(let r = 0; r < 7; r++) {
    for(let c = 0; c < 7; c++) {
      const cells = [
        `${letters[r]}${c+1}`, `${letters[r]}${c+2}`,
        `${letters[r+1]}${c+1}`, `${letters[r+1]}${c+2}`
      ];
      cards.push({
        type: 'set',
        subtype: '2x2',
        id: `2x2_${r}_${c}`,
        label: `2√ó2 ${letters[r]}${c+1}`,
        cells: cells
      });
    }
  }
  return cards;
};

// ‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏ã‡∏ï 4x4 (4 ‡πÉ‡∏ö)
const generate4x4Cards = () => {
  const cards = [];
  const letters = ['A','B','C','D','E','F','G','H'];
  const quarters = [
    {r: 0, c: 0, name: 'Q1'}, {r: 0, c: 4, name: 'Q2'},
    {r: 4, c: 0, name: 'Q3'}, {r: 4, c: 4, name: 'Q4'}
  ];
  
  quarters.forEach(q => {
    const cells = [];
    for(let r = q.r; r < q.r + 4; r++) {
      for(let c = q.c; c < q.c + 4; c++) {
        cells.push(`${letters[r]}${c+1}`);
      }
    }
    cards.push({
      type: 'set',
      subtype: '4x4',
      id: `4x4_${q.name}`,
      label: `4√ó4 ${q.name}`,
      cells: cells
    });
  });
  
  return cards;
};

// ‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢
const generateMarkerCards = () => {
  const cards = [];
  
  // Union (4 ‡πÉ‡∏ö)
  for(let i = 0; i < 4; i++) {
    cards.push({
      type: 'marker',
      subtype: 'union',
      id: `union_${i}`,
      label: 'Union (‚à™)'
    });
  }
  
  // Intersection (12 ‡πÉ‡∏ö)
  for(let i = 0; i < 12; i++) {
    cards.push({
      type: 'marker',
      subtype: 'intersection',
      id: `intersection_${i}`,
      label: 'Intersection (‚à©)'
    });
  }
  
  // Difference (12 ‡πÉ‡∏ö)
  for(let i = 0; i < 12; i++) {
    cards.push({
      type: 'marker',
      subtype: 'difference',
      id: `difference_${i}`,
      label: 'Difference (‚àí)'
    });
  }
  
  // Complement (4 ‡πÉ‡∏ö) - ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô‡∏ó‡∏µ‡πà 10
  for(let i = 0; i < 4; i++) {
    cards.push({
      type: 'marker',
      subtype: 'complement',
      id: `complement_${i}`,
      label: 'Complement (·∂ú)'
    });
  }
  
  return cards;
};

// ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏ã‡∏ï‡∏ß‡πà‡∏≤‡∏á (Empty Set)
const generateEmptySetCards = () => {
  const cards = [];
  for(let i = 0; i < 10; i++) {
    cards.push({
      type: 'set',
      subtype: 'empty',
      id: `empty_${i}`,
      label: 'Empty Set ‚àÖ',
      cells: [] // ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà
    });
  }
  return cards;
};

// ‡∏´‡∏≤‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
const getAllConnectedAreas = () => {
  const visited = new Set();
  const areas = [];
  
  for (let row = 0; row < 8; row++) {
    for (let col = 0; col < 8; col++) {
      const pos = `${String.fromCharCode(65 + row)}${col + 1}`;
      if (gameState.board[pos] && !visited.has(pos)) {
        const area = [];
        const playerColor = gameState.board[pos];
        
        const explore = (position) => {
          if (visited.has(position) || !gameState.board[position] || gameState.board[position] !== playerColor) return;
          visited.add(position);
          area.push(position);
          
          getAdjacentCells(position).forEach(adjPos => explore(adjPos));
        };
        
        explore(pos);
        if (area.length > 0) {
          areas.push({ positions: area, color: playerColor, size: area.length });
        }
      }
    }
  }
  
  return areas;
};

// ‡∏´‡∏≤‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ó‡∏µ‡πà‡πÄ‡∏•‡πá‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏ù‡∏±‡πà‡∏á‡∏ï‡∏£‡∏á‡∏Ç‡πâ‡∏≤‡∏°
const getSmallestOpponentArea = () => {
  const opponentColor = gameState.currentPlayer === 'black' ? 'white' : 'black';
  const allAreas = getAllConnectedAreas();
  const opponentAreas = allAreas.filter(area => area.color === opponentColor);
  
  if (opponentAreas.length === 0) return [];
  
  const smallestArea = opponentAreas.reduce((min, current) => 
    current.size < min.size ? current : min
  );
  
  return smallestArea.positions;
};

// ‡πÉ‡∏ä‡πâ Empty Set ‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢
const applyEmptySetWithMarker = (emptySetCard, markerCard) => {
  const opponentColor = gameState.currentPlayer === 'black' ? 'white' : 'black';
  const playerName = getPlayerName(gameState.currentPlayer);
  
  // ‡∏´‡∏≤‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡πá‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏ù‡∏±‡πà‡∏á‡∏ï‡∏£‡∏á‡∏Ç‡πâ‡∏≤‡∏°
  const smallestOpponentArea = getSmallestOpponentArea();
  
  if (smallestOpponentArea.length === 0) {
    alert('‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏Ç‡∏≠‡∏á‡∏ù‡∏±‡πà‡∏á‡∏ï‡∏£‡∏á‡∏Ç‡πâ‡∏≤‡∏°‡∏ö‡∏ô‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô!');
    
    // ‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÅ‡∏°‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
    const setIndex = gameState.selectedCards.find(i => gameState.players[gameState.currentPlayer].hand[i].type === 'set');
    const markerIndex = gameState.selectedCards.find(i => gameState.players[gameState.currentPlayer].hand[i].type === 'marker');
    const allIndices = [setIndex, markerIndex].sort((a, b) => b - a);
    allIndices.forEach(index => gameState.players[gameState.currentPlayer].hand.splice(index, 1));
    
    gameState.selectedCards = [];
    updateDisplay();
    return;
  }
  
  let logMsg = `${playerName} ‡πÉ‡∏ä‡πâ ${emptySetCard.label} + ${markerCard.label} ‡∏Å‡∏±‡∏ö‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà ${smallestOpponentArea.length} ‡∏ä‡πà‡∏≠‡∏á: ${smallestOpponentArea.join(', ')}`;
  
  switch(markerCard.subtype) {
    case 'union':
      // Union + Empty Set = ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏î‡∏≠‡∏∞‡πÑ‡∏£
      logMsg += ' ‚Üí ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á (Union + Empty Set)';
      break;
      
    case 'intersection':
      // Intersection + Empty Set = ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πâ‡∏ô‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á
      smallestOpponentArea.forEach(pos => {
        delete gameState.board[pos];
        const cell = document.querySelector(`[data-position="${pos}"]`);
        if(cell) {
          cell.innerHTML = pos;
          cell.style.backgroundColor = 'white';
        }
      });
      updateTokenCounts();
      logMsg += ' ‚Üí ‡∏•‡∏ö‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô (Intersection + Empty Set)';
      break;
      
    case 'difference':
      // Difference + Empty Set = ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏î‡∏≠‡∏∞‡πÑ‡∏£
      logMsg += ' ‚Üí ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á (Difference + Empty Set)';
      break;
      
    case 'complement':
      // Complement + Empty Set = ‡πÑ‡∏î‡πâ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏±‡πâ‡∏á‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤
      const allCells = [];
      for (let row = 0; row < 8; row++) {
        for (let col = 0; col < 8; col++) {
          allCells.push(`${String.fromCharCode(65 + row)}${col + 1}`);
        }
      }
      
      allCells.forEach(pos => {
        gameState.board[pos] = gameState.currentPlayer;
        const cell = document.querySelector(`[data-position="${pos}"]`);
        if(cell) {
          const chip = document.createElement('div');
          chip.className = `chip ${gameState.currentPlayer}`;
          chip.textContent = gameState.currentPlayer === 'black' ? '‚ö´' : '‚ö™';
          cell.innerHTML = '';
          cell.appendChild(chip);
          cell.style.backgroundColor = gameState.currentPlayer === 'black' ? '#f3f4f6' : '#fef3c7';
        }
      });
      updateTokenCounts();
      logMsg += ' ‚Üí ‡∏¢‡∏∂‡∏î‡∏Ñ‡∏£‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô! (Complement + Empty Set)';
      break;
  }
  
  logMessage(logMsg);
  
  // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
  gameState.cardsPlacedThisTurn.set = true;
  gameState.cardsPlacedThisTurn.marker = true;
  
  // ‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á‡πÉ‡∏ö
  const setIndex = gameState.selectedCards.find(i => gameState.players[gameState.currentPlayer].hand[i].type === 'set');
  const markerIndex = gameState.selectedCards.find(i => gameState.players[gameState.currentPlayer].hand[i].type === 'marker');
  const allIndices = [setIndex, markerIndex].sort((a, b) => b - a);
  allIndices.forEach(index => gameState.players[gameState.currentPlayer].hand.splice(index, 1));
  
  gameState.selectedCards = [];
  updateDisplay();
  
  // ‡∏à‡∏ö‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
  setTimeout(() => {
    skipTurn();
  }, 1000);
  updateGameStatus('‡πÉ‡∏ä‡πâ Empty Set ‡πÅ‡∏•‡πâ‡∏ß - ‡∏à‡∏∞‡∏à‡∏ö‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô‡πÉ‡∏ô‡∏≠‡∏µ‡∏Å 1 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ...');
  enableButtons([]);
};

// ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô
const createBoard = () => {
  const board = document.getElementById('gameBoard');
  board.innerHTML = '';
  
  const letters = ['A','B','C','D','E','F','G','H'];
  const numbers = ['1','2','3','4','5','6','7','8'];
  
  // ‡∏°‡∏∏‡∏°‡∏ã‡πâ‡∏≤‡∏¢‡∏ö‡∏ô
  const cornerCell = document.createElement('div');
  cornerCell.className = 'cell header';
  cornerCell.textContent = 'üéØ';
  board.appendChild(cornerCell);
  
  // ‡∏´‡∏±‡∏ß‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå
  numbers.forEach(num => {
    const cell = document.createElement('div');
    cell.className = 'cell header';
    cell.textContent = num;
    board.appendChild(cell);
  });
  
  // ‡πÅ‡∏ñ‡∏ß‡πÅ‡∏•‡∏∞‡πÄ‡∏ã‡∏•‡∏•‡πå‡πÄ‡∏Å‡∏°
  letters.forEach(letter => {
    // ‡∏´‡∏±‡∏ß‡πÅ‡∏ñ‡∏ß
    const rowHeader = document.createElement('div');
    rowHeader.className = 'cell header';
    rowHeader.textContent = letter;
    board.appendChild(rowHeader);
    
    // ‡πÄ‡∏ã‡∏•‡∏•‡πå‡πÄ‡∏Å‡∏°
    numbers.forEach(num => {
      const cell = document.createElement('div');
      cell.className = 'cell game-cell';
      cell.dataset.position = `${letter}${num}`;
      cell.textContent = `${letter}${num}`;
      board.appendChild(cell);
    });
  });
};

// ‡∏™‡∏∏‡πà‡∏°‡∏Å‡∏≤‡∏£‡πå‡∏î
const shuffleArray = (array) => {
  const newArray = [...array];
  for (let i = newArray.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
  }
  return newArray;
};

// ‡∏´‡∏≤‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏¥‡∏î‡∏Å‡∏±‡∏ô
const getAdjacentCells = (position) => {
  const letter = position.charAt(0);
  const number = parseInt(position.charAt(1));
  const adjacent = [];
  
  // ‡∏Ç‡∏∂‡πâ‡∏ô, ‡∏•‡∏á, ‡∏ã‡πâ‡∏≤‡∏¢, ‡∏Ç‡∏ß‡∏≤
  const directions = [
    { row: -1, col: 0 }, // ‡∏Ç‡∏∂‡πâ‡∏ô
    { row: 1, col: 0 },  // ‡∏•‡∏á
    { row: 0, col: -1 }, // ‡∏ã‡πâ‡∏≤‡∏¢
    { row: 0, col: 1 }   // ‡∏Ç‡∏ß‡∏≤
  ];
  
  const letterIndex = letter.charCodeAt(0) - 65; // A=0, B=1, ...
  
  directions.forEach(dir => {
    const newRow = letterIndex + dir.row;
    const newCol = number - 1 + dir.col; // number ‡πÄ‡∏õ‡πá‡∏ô 1-based
    
    if (newRow >= 0 && newRow <= 7 && newCol >= 0 && newCol <= 7) {
      const newLetter = String.fromCharCode(65 + newRow);
      const newNumber = newCol + 1;
      adjacent.push(`${newLetter}${newNumber}`);
    }
  });
  
  return adjacent;
};

// ‡∏´‡∏≤‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ô (Connected Components)
const getConnectedArea = (startPositions, playerColor) => {
  const visited = new Set();
  const connectedArea = new Set();
  
  const dfs = (position) => {
    if (visited.has(position) || connectedArea.has(position)) return;
    
    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ä‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
    if (!gameState.board[position] || gameState.board[position] !== playerColor) {
      return;
    }
    
    visited.add(position);
    connectedArea.add(position);
    
    // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡πà‡∏≠‡∏á‡∏ï‡∏¥‡∏î‡∏Å‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏™‡∏µ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô
    const adjacent = getAdjacentCells(position);
    adjacent.forEach(adjPos => {
      if (gameState.board[adjPos] === playerColor) {
        dfs(adjPos);
      }
    });
  };
  
  // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏à‡∏≤‡∏Å‡∏ó‡∏∏‡∏Å‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
  startPositions.forEach(pos => {
    if (gameState.board[pos] === playerColor) {
      dfs(pos);
    }
  });
  
  return Array.from(connectedArea);
};

// ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡πÉ‡∏´‡∏°‡πà
let selectedPlayerColor = null;
let aiColor = null;
let gameMode = null; // 'ai' ‡∏´‡∏£‡∏∑‡∏≠ 'friend'

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏à‡∏≤‡∏Å‡∏Å‡∏≠‡∏á (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö pregame phase)
const changeCardFromDeck = () => {
  const cardIndex = gameState.selectedCards[0];
  const oldCard = gameState.players[gameState.currentPlayer].hand[cardIndex];
  
  // ‡πÉ‡∏™‡πà‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏Å‡πà‡∏≤‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡∏Å‡∏≠‡∏á
  gameState.deckSet.unshift(oldCard);
  
  // ‡∏à‡∏±‡πà‡∏ß‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÉ‡∏´‡∏°‡πà‡∏à‡∏≤‡∏Å‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô
  if(gameState.deckSet.length > 1) {
    const newCard = gameState.deckSet.pop();
    gameState.players[gameState.currentPlayer].hand[cardIndex] = newCard;
    
    const playerName = getPlayerName(gameState.currentPlayer);
    logMessage(`${playerName} ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Å‡∏≤‡∏£‡πå‡∏î: ${oldCard.label} ‚Üí ${newCard.label} (‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏Å‡∏≤‡∏£‡∏ã‡πâ‡∏≥)`);
    
    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÉ‡∏´‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ã‡πâ‡∏≥‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
    const conflicts = newCard.cells.filter(pos => gameState.board[pos]);
    if(conflicts.length > 0) {
      // ‡∏¢‡∏±‡∏á‡∏ã‡πâ‡∏≥‡∏≠‡∏¢‡∏π‡πà ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
      const isAI = gameState.players[gameState.currentPlayer].isAI;
      
      if(isAI) {
        // AI ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥
        if(gameState.deckSet.length > 1) {
          changeCardFromDeck();
          return;
        }
      } else {
        // ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏Ñ‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
        const continueChange = confirm(`‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÉ‡∏´‡∏°‡πà‡∏¢‡∏±‡∏á‡∏ã‡πâ‡∏≥‡∏Å‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÅ‡∏£‡∏Å‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà: ${conflicts.join(', ')}\n\n‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`);
        
        if(continueChange && gameState.deckSet.length > 1) {
          changeCardFromDeck();
          return;
        } else {
          // ‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏≠‡∏∑‡πà‡∏ô‡∏à‡∏≤‡∏Å‡∏°‡∏∑‡∏≠
          alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏≠‡∏∑‡πà‡∏ô‡∏à‡∏≤‡∏Å‡∏°‡∏∑‡∏≠ ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á');
          gameState.selectedCards = [];
          updateDisplay();
          return;
        }
      }
    }
    
    // ‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥ ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ
    gameState.selectedCards = [cardIndex];
    updateDisplay();
    
    const isAI = gameState.players[gameState.currentPlayer].isAI;
    
    if(isAI) {
      // AI ‡∏ß‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
      setTimeout(() => {
        placePregameCard();
      }, 300);
    } else {
      // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô
      updateGameStatus('‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥‡πÅ‡∏•‡πâ‡∏ß - ‡∏Å‡∏î‡∏ß‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠');
      enableButtons(['placeCardsBtn']);
    }
    
  } else {
    alert('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÉ‡∏ô‡∏Å‡∏≠‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô!');
  }
};

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô
const getPlayerName = (color) => {
  if (!gameState || !gameState.gameMode) {
    return color === 'black' ? '‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏î‡∏≥' : '‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏Ç‡∏≤‡∏ß';
  }
  
  if (gameState.gameMode === 'ai') {
    if (gameState.players[color].isAI) {
      return color === 'black' ? 'AI (‡∏î‡∏≥)' : 'AI (‡∏Ç‡∏≤‡∏ß)';
    } else {
      return color === 'black' ? '‡∏Ñ‡∏∏‡∏ì (‡∏î‡∏≥)' : '‡∏Ñ‡∏∏‡∏ì (‡∏Ç‡∏≤‡∏ß)';
    }
  } else {
    return color === 'black' ? '‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô 1 (‡∏î‡∏≥)' : '‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô 2 (‡∏Ç‡∏≤‡∏ß)';
  }
};

const startNewGame = () => {
  // ‡πÅ‡∏™‡∏î‡∏á modal ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏´‡∏°‡∏î‡πÄ‡∏Å‡∏°
  document.getElementById('gameModeModal').style.display = 'flex';
};

const selectGameMode = (mode) => {
  gameMode = mode;
  
  // ‡∏ã‡πà‡∏≠‡∏ô modal ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏´‡∏°‡∏î
  document.getElementById('gameModeModal').style.display = 'none';
  
  // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ô modal ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏µ‡∏ï‡∏≤‡∏°‡πÇ‡∏´‡∏°‡∏î
  const colorModalTitle = document.getElementById('colorModalTitle');
  const colorModalDesc = document.getElementById('colorModalDesc');
  
  if (mode === 'ai') {
    colorModalTitle.textContent = 'üéØ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏µ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì';
    colorModalDesc.textContent = '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏µ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô (‡∏™‡∏µ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô AI)';
    
    // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÉ‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏µ
    document.querySelector('[data-color="black"] p').innerHTML = '‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏•‡πà‡∏ô‡∏™‡∏µ‡∏î‡∏≥<br>AI ‡πÄ‡∏•‡πà‡∏ô‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß';
    document.querySelector('[data-color="white"] p').innerHTML = '‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏•‡πà‡∏ô‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß<br>AI ‡πÄ‡∏•‡πà‡∏ô‡∏™‡∏µ‡∏î‡∏≥';
  } else {
    colorModalTitle.textContent = 'üéØ ‡πÉ‡∏Ñ‡∏£‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏î‡∏≥?';
    colorModalDesc.textContent = '‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏î‡∏≥‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡∏Å‡πà‡∏≠‡∏ô (‡πÑ‡∏°‡πà‡∏°‡∏µ AI ‡πÉ‡∏ô‡πÇ‡∏´‡∏°‡∏î‡∏ô‡∏µ‡πâ)';
    
    // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÉ‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏µ
    document.querySelector('[data-color="black"] p').innerHTML = '‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô 1 ‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡∏î‡∏≥<br>‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô 2 ‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß';
    document.querySelector('[data-color="white"] p').innerHTML = '‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô 1 ‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß<br>‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô 2 ‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡∏î‡∏≥';
  }
  
  // ‡πÅ‡∏™‡∏î‡∏á modal ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏µ
  document.getElementById('colorModal').style.display = 'flex';
};

const selectColor = (color) => {
  // ‡∏•‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤
  document.querySelectorAll('.color-option').forEach(option => {
    option.classList.remove('selected');
  });
  
  // ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏µ‡πÉ‡∏´‡∏°‡πà
  document.querySelector(`[data-color="${color}"]`).classList.add('selected');
  selectedPlayerColor = color;
  aiColor = color === 'black' ? 'white' : 'black';
  
  // ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°
  document.getElementById('confirmColorBtn').disabled = false;
};

const confirmColorSelection = () => {
  // ‡∏ã‡πà‡∏≠‡∏ô modal
  document.getElementById('colorModal').style.display = 'none';
  
  gameState = {
    phase: 'pregame',
    turn: 0,
    currentPlayer: 'black',
    playerColor: selectedPlayerColor,
    aiColor: aiColor,
    gameMode: gameMode, // ‡πÄ‡∏Å‡πá‡∏ö‡πÇ‡∏´‡∏°‡∏î‡πÄ‡∏Å‡∏°
    players: {
      black: { hand: [], score: 0, tokens: 0, isAI: gameMode === 'ai' && selectedPlayerColor !== 'black' },
      white: { hand: [], score: 0, tokens: 0, isAI: gameMode === 'ai' && selectedPlayerColor !== 'white' }
    },
    board: {},
    deckSet: shuffleArray([...generate2x2Cards(), ...generate4x4Cards(), ...generateEmptySetCards()]),
    deckMarker: shuffleArray(generateMarkerCards()),
    drawnThisTurn: false,
    cardsPlacedThisTurn: { set: false, marker: false },
    selectedCards: []
  };
  
  // ‡πÅ‡∏à‡∏Å‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô (‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏ã‡∏ï‡∏Ñ‡∏ô‡∏•‡∏∞ 2 ‡πÉ‡∏ö)
  for(let i = 0; i < 2; i++) {
    gameState.players.black.hand.push(gameState.deckSet.pop());
    gameState.players.white.hand.push(gameState.deckSet.pop());
  }
  
  clearBoard();
  updateDisplay();
  
  const playerName = selectedPlayerColor === 'black' ? '‡∏Ñ‡∏∏‡∏ì (‡∏î‡∏≥)' : 'AI (‡∏î‡∏≥)';
  const aiName = selectedPlayerColor === 'black' ? 'AI (‡∏Ç‡∏≤‡∏ß)' : '‡∏Ñ‡∏∏‡∏ì (‡∏Ç‡∏≤‡∏ß)';
  
  logMessage(`üéÆ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡πÉ‡∏´‡∏°‡πà! ${playerName} vs ${aiName}`);
  logMessage('üìù ‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏î‡∏≥‡∏•‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏ã‡∏ï 1 ‡πÉ‡∏ö‡∏Å‡πà‡∏≠‡∏ô (‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥‡∏Å‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏Ç‡∏≤‡∏ß)');
  
  if (gameState.players.black.isAI) {
    updateGameStatus('AI (‡∏î‡∏≥) ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡∏¥‡∏î...');
    setTimeout(() => aiMove(), 800); // ‡∏•‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏´‡πâ‡πÄ‡∏£‡πá‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô
  } else {
    updateGameStatus('‡∏Ñ‡∏∏‡∏ì (‡∏î‡∏≥): ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏ã‡∏ï 1 ‡πÉ‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ß‡∏≤‡∏á‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô');
  }
  enableButtons(['placeCardsBtn']);
};

// ‡∏•‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô
const clearBoard = () => {
  gameState.board = {};
  const cells = document.querySelectorAll('.game-cell');
  cells.forEach(cell => {
    cell.innerHTML = cell.dataset.position;
    cell.style.backgroundColor = 'white';
  });
};

// ‡∏ß‡∏≤‡∏á‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏ö‡∏ô‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô
const placeTokens = (positions, player) => {
  positions.forEach(pos => {
    gameState.board[pos] = player;
    const cell = document.querySelector(`[data-position="${pos}"]`);
    if(cell) {
      const chip = document.createElement('div');
      chip.className = `chip ${player}`;
      chip.textContent = player === 'black' ? '‚ö´' : '‚ö™';
      cell.innerHTML = '';
      cell.appendChild(chip);
      
      // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏≠‡∏á
      cell.style.backgroundColor = player === 'black' ? '#f3f4f6' : '#fef3c7';
    }
  });
  updateTokenCounts();
};

// ‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏ö‡∏µ‡πâ‡∏¢
const updateTokenCounts = () => {
  gameState.players.black.tokens = Object.values(gameState.board).filter(p => p === 'black').length;
  gameState.players.white.tokens = Object.values(gameState.board).filter(p => p === 'white').length;
};

// ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô
const calculateScore = (player) => {
  return gameState.players[player].tokens - gameState.players[player].hand.length;
};

// ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
const updateDisplay = () => {
  // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô
  document.getElementById('blackScore').textContent = `${calculateScore('black')} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô (‡πÄ‡∏ö‡∏µ‡πâ‡∏¢: ${gameState.players.black.tokens}, ‡∏Å‡∏≤‡∏£‡πå‡∏î: ${gameState.players.black.hand.length})`;
  document.getElementById('whiteScore').textContent = `${calculateScore('white')} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô (‡πÄ‡∏ö‡∏µ‡πâ‡∏¢: ${gameState.players.white.tokens}, ‡∏Å‡∏≤‡∏£‡πå‡∏î: ${gameState.players.white.hand.length})`;
  
  // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô
  const turnInfo = document.getElementById('turnInfo');
  turnInfo.className = 'turn-info'; // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï class
  
  if(gameState.phase === 'playing') {
    const playerName = gameState.currentPlayer === 'black' ? '‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏î‡∏≥' : '‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏Ç‡∏≤‡∏ß';
    const playerIcon = gameState.currentPlayer === 'black' ? '‚ö´' : '‚ö™';
    turnInfo.className = `turn-info ${gameState.currentPlayer}-turn`;
    turnInfo.innerHTML = `
      <div class="current-player-indicator">
        <span>${playerIcon}</span>
        <span>‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô‡∏ó‡∏µ‡πà ${gameState.turn}/20 - ${playerName}</span>
      </div>
    `;
  } else if(gameState.phase === 'pregame') {
    const playerName = gameState.currentPlayer === 'black' ? '‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏î‡∏≥' : '‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏Ç‡∏≤‡∏ß';
    const playerIcon = gameState.currentPlayer === 'black' ? '‚ö´' : '‚ö™';
    turnInfo.className = `turn-info ${gameState.currentPlayer}-turn`;
    turnInfo.innerHTML = `
      <div class="current-player-indicator">
        <span>${playerIcon}</span>
        <span>‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏° - ${playerName} ‡∏ß‡∏≤‡∏á‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</span>
      </div>
    `;
  } else if(gameState.phase === 'finished') {
    const blackScore = calculateScore('black');
    const whiteScore = calculateScore('white');
    const winner = blackScore > whiteScore ? '‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏î‡∏≥' : blackScore < whiteScore ? '‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏Ç‡∏≤‡∏ß' : '‡πÄ‡∏™‡∏°‡∏≠';
    turnInfo.textContent = `üèÅ ‡∏à‡∏ö‡πÄ‡∏Å‡∏°! ‡∏ú‡∏π‡πâ‡∏ä‡∏ô‡∏∞: ${winner}`;
  } else {
    turnInfo.textContent = '‡∏Å‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô';
  }
  
  // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÉ‡∏ô‡∏°‡∏∑‡∏≠
  updatePlayerHand();
  
  // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠
  updateCardCounts();
};

// ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÉ‡∏ô‡∏°‡∏∑‡∏≠
const updatePlayerHand = () => {
  const handDiv = document.getElementById('playerHand');
  handDiv.innerHTML = '';
  
  if(gameState.phase === 'waiting') return;
  
  const currentHand = gameState.players[gameState.currentPlayer].hand;
  currentHand.forEach((card, index) => {
    const cardElement = document.createElement('div');
    cardElement.className = `card ${card.type}`;
    cardElement.onclick = () => selectCard(index);
    
    // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏•‡∏±‡∏Å
    const labelDiv = document.createElement('div');
    labelDiv.textContent = card.label;
    cardElement.appendChild(labelDiv);
    
    // ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏ã‡∏ï
    if(card.type === 'set' && card.cells) {
      const detailsDiv = document.createElement('div');
      detailsDiv.className = 'card-details';
      detailsDiv.textContent = `‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà: ${card.cells.join(', ')}`;
      cardElement.appendChild(detailsDiv);
    }
    
    cardElement.dataset.index = index;
    
    if(gameState.selectedCards.includes(index)) {
      cardElement.classList.add('selected');
    }
    
    handDiv.appendChild(cardElement);
  });
};

// ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡πå‡∏î
const selectCard = (index) => {
  const cardIndex = gameState.selectedCards.indexOf(index);
  if(cardIndex === -1) {
    gameState.selectedCards.push(index);
  } else {
    gameState.selectedCards.splice(cardIndex, 1);
  }
  updatePlayerHand();
};

// ‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î‡∏õ‡∏∏‡πà‡∏°
const enableButtons = (buttons) => {
  const allButtons = ['drawSetBtn', 'drawMarkerBtn', 'placeCardsBtn', 'discardBtn', 'skipTurnBtn'];
  allButtons.forEach(id => {
    document.getElementById(id).disabled = !buttons.includes(id);
  });
};

// ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏Å‡∏°
const updateGameStatus = (message) => {
  document.getElementById('gameStatus').textContent = message;
};

// ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
const logMessage = (message) => {
  const logDiv = document.getElementById('gameLog');
  const entry = document.createElement('div');
  entry.className = 'log-entry';
  entry.textContent = message;
  logDiv.appendChild(entry);
  logDiv.scrollTop = logDiv.scrollHeight;
};

// ‡∏à‡∏±‡πà‡∏ß‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏ã‡∏ï
const drawSetCard = () => {
  if(gameState.drawnThisTurn) {
    alert('‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏à‡∏±‡πà‡∏ß‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÉ‡∏ô‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß!');
    return;
  }
  
  if(gameState.deckSet.length === 0) {
    alert('‡∏Å‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏ã‡∏ï‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß!');
    return;
  }
  
  const card = gameState.deckSet.pop();
  gameState.players[gameState.currentPlayer].hand.push(card);
  
  const playerName = getPlayerName(gameState.currentPlayer);
  logMessage(`${playerName} ‡∏à‡∏±‡πà‡∏ß‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏ã‡∏ï: ${card.label} (${card.cells.join(', ')})`);
  
  // ‡∏à‡∏±‡πà‡∏ß‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏ä‡πâ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå
  gameState.drawnThisTurn = true;
  gameState.turnPhase = 'action';
  updateDisplay();
  
  if (gameState.players[gameState.currentPlayer].isAI) {
    updateGameStatus('AI ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡∏¥‡∏î‡∏ß‡πà‡∏≤‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£...');
    setTimeout(() => aiMove(), 600); // ‡∏•‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏´‡πâ‡πÄ‡∏£‡πá‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô
  } else {
    updateGameStatus('‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏ä‡πâ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå: ‡∏•‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 2 ‡πÉ‡∏ö ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏•‡∏∞ 1 ‡πÉ‡∏ö), ‡∏ó‡∏¥‡πâ‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î (1 ‡πÉ‡∏ö), ‡∏´‡∏£‡∏∑‡∏≠‡∏Ç‡πâ‡∏≤‡∏°‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô');
    enableButtons(['placeCardsBtn', 'discardBtn', 'skipTurnBtn']);
  }
};

// ‡∏à‡∏±‡πà‡∏ß‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢
const drawMarkerCard = () => {
  if(gameState.drawnThisTurn) {
    alert('‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏à‡∏±‡πà‡∏ß‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÉ‡∏ô‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß!');
    return;
  }
  
  if(gameState.deckMarker.length === 0) {
    alert('‡∏Å‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß!');
    return;
  }
  
  let card = gameState.deckMarker.pop();
  
  // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏é‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô‡∏ó‡∏µ‡πà 16+ ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Union
  let unionDiscarded = 0;
  while(gameState.turn >= 16 && card.subtype === 'union') {
    unionDiscarded++;
    logMessage(`‚ö†Ô∏è ‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô‡∏ó‡∏µ‡πà 16+ ‡∏à‡∏±‡πà‡∏ß‡πÑ‡∏î‡πâ Union (‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà ${unionDiscarded}) ‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏¥‡πâ‡∏á‡πÅ‡∏•‡∏∞‡∏à‡∏±‡πà‡∏ß‡πÉ‡∏´‡∏°‡πà`);
    
    if(gameState.deckMarker.length === 0) {
      alert('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡πÉ‡∏´‡πâ‡∏à‡∏±‡πà‡∏ß‡πÅ‡∏•‡πâ‡∏ß!');
      return;
    }
    card = gameState.deckMarker.pop();
    
    // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ß‡∏ô‡∏•‡∏π‡∏õ‡πÑ‡∏°‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î
    if(unionDiscarded >= 10) {
      alert('‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πå‡∏î Union ‡∏°‡∏≤‡∏Å‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏à‡∏±‡πà‡∏ß‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏≠‡∏∑‡πà‡∏ô‡πÑ‡∏î‡πâ!');
      return;
    }
  }
  
  // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏é Complement (‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô‡∏ó‡∏µ‡πà 10)
  if(card.subtype === 'complement' && gameState.turn < 10) {
    logMessage('‚ö†Ô∏è ‡∏Å‡∏≤‡∏£‡πå‡∏î Complement ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô‡∏ó‡∏µ‡πà 10 ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô - ‡∏ó‡∏¥‡πâ‡∏á‡πÅ‡∏•‡∏∞‡∏à‡∏±‡πà‡∏ß‡πÉ‡∏´‡∏°‡πà');
    
    if(gameState.deckMarker.length === 0) {
      alert('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡πÉ‡∏´‡πâ‡∏à‡∏±‡πà‡∏ß‡πÅ‡∏•‡πâ‡∏ß!');
      return;
    }
    card = gameState.deckMarker.pop();
    
    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ã‡πâ‡∏≥‡∏ñ‡πâ‡∏≤‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÉ‡∏´‡∏°‡πà‡∏¢‡∏±‡∏á‡πÄ‡∏õ‡πá‡∏ô Complement
    if(card.subtype === 'complement' && gameState.turn < 10) {
      logMessage('‚ö†Ô∏è ‡∏à‡∏±‡πà‡∏ß‡πÑ‡∏î‡πâ Complement ‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á - ‡∏ó‡∏¥‡πâ‡∏á‡πÅ‡∏•‡∏∞‡∏à‡∏±‡πà‡∏ß‡πÉ‡∏´‡∏°‡πà');
      
      if(gameState.deckMarker.length === 0) {
        alert('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡πÉ‡∏´‡πâ‡∏à‡∏±‡πà‡∏ß‡πÅ‡∏•‡πâ‡∏ß!');
        return;
      }
      card = gameState.deckMarker.pop();
    }
  }
  
  gameState.players[gameState.currentPlayer].hand.push(card);
  
  const playerName = getPlayerName(gameState.currentPlayer);
  logMessage(`${playerName} ‡∏à‡∏±‡πà‡∏ß‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢: ${card.label}`);
  
  // ‡∏à‡∏±‡πà‡∏ß‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏ä‡πâ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå
  gameState.drawnThisTurn = true;
  gameState.turnPhase = 'action';
  updateDisplay();
  
  if (gameState.players[gameState.currentPlayer].isAI) {
    updateGameStatus('AI ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡∏¥‡∏î‡∏ß‡πà‡∏≤‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£...');
    setTimeout(() => aiMove(), 600); // ‡∏•‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏´‡πâ‡πÄ‡∏£‡πá‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô
  } else {
    updateGameStatus('‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏ä‡πâ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå: ‡∏•‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 2 ‡πÉ‡∏ö ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏•‡∏∞ 1 ‡πÉ‡∏ö), ‡∏ó‡∏¥‡πâ‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î (1 ‡πÉ‡∏ö), ‡∏´‡∏£‡∏∑‡∏≠‡∏Ç‡πâ‡∏≤‡∏°‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô');
    enableButtons(['placeCardsBtn', 'discardBtn', 'skipTurnBtn']);
  }
};

// ‡∏•‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î
const placeCards = () => {
  if(gameState.phase === 'pregame') {
    placePregameCard();
    return;
  }
  
  if(gameState.turnPhase !== 'action') {
    alert('‡∏ï‡πâ‡∏≠‡∏á‡∏à‡∏±‡πà‡∏ß‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏•‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î!');
    return;
  }
  
  if(gameState.selectedCards.length === 0) {
    alert('‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏Å‡πà‡∏≠‡∏ô!');
    return;
  }
  
  if(gameState.selectedCards.length > 2) {
    alert('‡∏•‡∏á‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 2 ‡πÉ‡∏ö (‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏•‡∏∞ 1 ‡πÉ‡∏ö)!');
    return;
  }
  
  // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡πå‡∏î
  const selectedCardObjs = gameState.selectedCards.map(i => gameState.players[gameState.currentPlayer].hand[i]);
  const setCards = selectedCardObjs.filter(c => c.type === 'set');
  const markerCards = selectedCardObjs.filter(c => c.type === 'marker');
  
  if(setCards.length > 1 || markerCards.length > 1) {
    alert('‡∏•‡∏á‡πÑ‡∏î‡πâ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏•‡∏∞ 1 ‡πÉ‡∏ö‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô!');
    return;
  }
  
  // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏•‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á
  if(setCards.length > 0 && gameState.cardsPlacedThisTurn.set) {
    alert('‡∏•‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏ã‡∏ï‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏ô‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô‡∏ô‡∏µ‡πâ!');
    return;
  }
  
  if(markerCards.length > 0 && gameState.cardsPlacedThisTurn.marker) {
    alert('‡∏•‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏ô‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô‡∏ô‡∏µ‡πâ!');
    return;
  }
  
  // ‡∏•‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏ã‡∏ï
  if(setCards.length > 0) {
    const setCard = setCards[0];
    
    // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Empty Set (‡πÄ‡∏ã‡∏ï‡∏ß‡πà‡∏≤‡∏á)
    if(setCard.subtype === 'empty') {
      if(markerCards.length === 0) {
        alert('Empty Set ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢!');
        return;
      }
      
      const markerCard = markerCards[0];
      applyEmptySetWithMarker(setCard, markerCard);
      return;
    }
    
    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô
    const conflicts = setCard.cells.filter(pos => gameState.board[pos] && gameState.board[pos] !== gameState.currentPlayer);
    
    // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏π‡πà
    if(conflicts.length > 0) {
      // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏î‡πâ‡∏ß‡∏¢‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
      if(markerCards.length === 0) {
        alert(`‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏ã‡∏ï‡∏ó‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡∏Å‡∏±‡∏ö‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏ù‡∏±‡πà‡∏á‡∏ï‡∏£‡∏á‡∏Ç‡πâ‡∏≤‡∏°‡∏ó‡∏µ‡πà: ${conflicts.join(', ')}\n‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏π‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô!`);
        return;
      }
      
      // ‡πÉ‡∏ä‡πâ‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏ã‡∏ï + ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢
      const markerCard = markerCards[0];
      applySetWithMarker(setCard, markerCard, conflicts);
    } else {
      // ‡∏•‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏ã‡∏ï‡∏õ‡∏Å‡∏ï‡∏¥ (‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô)
      placeTokens(setCard.cells, gameState.currentPlayer);
      gameState.cardsPlacedThisTurn.set = true;
      
      const playerName = gameState.currentPlayer === 'black' ? '‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏î‡∏≥' : '‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏Ç‡∏≤‡∏ß';
      logMessage(`${playerName} ‡∏•‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏ã‡∏ï: ${setCard.label}`);
    }
  }
  
  // ‡∏•‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡πÇ‡∏î‡∏¢‡∏•‡∏≥‡∏û‡∏±‡∏á (‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏ã‡∏ï 2 ‡πÉ‡∏ö)
  if(markerCards.length > 0 && setCards.length === 0) {
    const markerCard = markerCards[0];
    
    // ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏ã‡∏ï‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 2 ‡πÉ‡∏ö‡πÉ‡∏ô‡∏°‡∏∑‡∏≠
    const allSetCards = gameState.players[gameState.currentPlayer].hand.filter(c => c.type === 'set');
    if(allSetCards.length < 2) {
      alert('‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏ã‡∏ï‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 2 ‡πÉ‡∏ö‡πÉ‡∏ô‡∏°‡∏∑‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢!');
      return;
    }
    
    // ‡πÄ‡∏õ‡∏¥‡∏î Modal ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏ã‡∏ï 2 ‡πÉ‡∏ö
    showSetSelectionModal(markerCard);
    return;
  }
  
  // ‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ó‡∏µ‡πà‡∏•‡∏á‡πÅ‡∏•‡πâ‡∏ß‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏°‡∏∑‡∏≠
  gameState.selectedCards.sort((a, b) => b - a).forEach(index => {
    gameState.players[gameState.currentPlayer].hand.splice(index, 1);
  });
  
  gameState.selectedCards = [];
  updateDisplay();
  
  // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏î‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
  const canPlaceMore = (!gameState.cardsPlacedThisTurn.set || !gameState.cardsPlacedThisTurn.marker) &&
                      gameState.players[gameState.currentPlayer].hand.length > 0;
  
  if(canPlaceMore) {
    // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô AI ‡πÉ‡∏´‡πâ‡∏à‡∏ö‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ ‡πÑ‡∏°‡πà‡∏•‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ï‡πà‡∏≠
    if (gameState.players[gameState.currentPlayer].isAI) {
      setTimeout(() => {
        skipTurn();
      }, 500); // AI ‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏ö‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô
      updateGameStatus('AI ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß - ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏ö‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô...');
      enableButtons([]);
    } else {
      updateGameStatus('‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏î‡πâ (‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏•‡∏∞ 1 ‡πÉ‡∏ö) ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏¥‡πâ‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î/‡∏Ç‡πâ‡∏≤‡∏°‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô');
      enableButtons(['placeCardsBtn', 'discardBtn', 'skipTurnBtn']);
    }
  } else {
    // ‡∏à‡∏ö‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏•‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏Ñ‡∏£‡∏ö‡πÅ‡∏•‡πâ‡∏ß
    const delay = gameState.players[gameState.currentPlayer].isAI ? 300 : 1000; // AI ‡∏à‡∏ö‡πÄ‡∏£‡πá‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô
    setTimeout(() => {
      skipTurn();
    }, delay);
    const message = gameState.players[gameState.currentPlayer].isAI ? 
      'AI ‡∏•‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏Ñ‡∏£‡∏ö‡πÅ‡∏•‡πâ‡∏ß - ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏ö‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô...' : 
      '‡∏•‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏Ñ‡∏£‡∏ö‡πÅ‡∏•‡πâ‡∏ß - ‡∏à‡∏∞‡∏à‡∏ö‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô‡πÉ‡∏ô‡∏≠‡∏µ‡∏Å 1 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ...';
    updateGameStatus(message);
    enableButtons([]);
  }
};

// ‡∏ß‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°
const placePregameCard = () => {
  if(gameState.selectedCards.length !== 1) {
    alert('‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏ã‡∏ï 1 ‡πÉ‡∏ö!');
    return;
  }
  
  const cardIndex = gameState.selectedCards[0];
  const card = gameState.players[gameState.currentPlayer].hand[cardIndex];
  
  if(card.type !== 'set') {
    alert('‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏ã‡∏ï‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô!');
    return;
  }
  
  // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏á)
  if(gameState.currentPlayer === 'white') {
    const conflicts = card.cells.filter(pos => gameState.board[pos]);
    if(conflicts.length > 0) {
      // ‡πÄ‡∏™‡∏ô‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Å‡∏≤‡∏£‡πå‡∏î
      const changeCard = confirm(`‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ó‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡∏Å‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÅ‡∏£‡∏Å‡∏ó‡∏µ‡πà: ${conflicts.join(', ')}\n\n‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÉ‡∏´‡∏°‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?\n(OK = ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Å‡∏≤‡∏£‡πå‡∏î, Cancel = ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏≠‡∏∑‡πà‡∏ô‡∏à‡∏≤‡∏Å‡∏°‡∏∑‡∏≠)`);
      
      if(changeCard) {
        // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÉ‡∏´‡∏°‡πà‡∏à‡∏≤‡∏Å‡∏Å‡∏≠‡∏á
        changeCardFromDeck();
        return;
      } else {
        // ‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏≠‡∏∑‡πà‡∏ô‡∏à‡∏≤‡∏Å‡∏°‡∏∑‡∏≠
        gameState.selectedCards = [];
        updateDisplay();
        return;
      }
    }
  }
  
  placeTokens(card.cells, gameState.currentPlayer);
  gameState.players[gameState.currentPlayer].hand.splice(cardIndex, 1);
  gameState.selectedCards = [];
  
  const playerName = gameState.currentPlayer === 'black' ? '‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏î‡∏≥' : '‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏Ç‡∏≤‡∏ß';
  logMessage(`${playerName} ‡∏ß‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏ã‡∏ï‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô: ${card.label}`);
  
  if(gameState.currentPlayer === 'black') {
    gameState.currentPlayer = 'white';
    updateDisplay();
    
    if (gameState.players.white.isAI) {
      updateGameStatus('AI (‡∏Ç‡∏≤‡∏ß) ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡πå‡∏î...');
      setTimeout(() => aiMove(), 400);
    } else {
      updateGameStatus('‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏Ç‡∏≤‡∏ß: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏ã‡∏ï 1 ‡πÉ‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ß‡∏≤‡∏á‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô (‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏ó‡∏±‡∏ö‡∏Å‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏î‡∏≥)');
      enableButtons(['placeCardsBtn']);
    }
  } else {
    // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡∏à‡∏£‡∏¥‡∏á
    gameState.phase = 'playing';
    gameState.turn = 1;
    gameState.turnPhase = 'draw';
    gameState.currentPlayer = 'black';
    gameState.drawnThisTurn = false;
    gameState.cardsPlacedThisTurn = { set: false, marker: false };
    
    logMessage('üéØ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡∏à‡∏£‡∏¥‡∏á! ‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô‡∏ó‡∏µ‡πà 1 - ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏î‡∏≥');
    updateDisplay();
    
    if (gameState.players.black.isAI) {
      updateGameStatus('AI (‡∏î‡∏≥) ‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô‡πÅ‡∏£‡∏Å - ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡∏¥‡∏î...');
      setTimeout(() => aiMove(), 400);
    } else {
      updateGameStatus('‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏î‡∏≥: ‡∏à‡∏±‡πà‡∏ß‡∏Å‡∏≤‡∏£‡πå‡∏î 1 ‡πÉ‡∏ö‡∏Å‡πà‡∏≠‡∏ô');
      enableButtons(['drawSetBtn', 'drawMarkerBtn']);
    }
  }
};

// ‡πÅ‡∏™‡∏î‡∏á Modal ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏ã‡∏ï
const showSetSelectionModal = (markerCard) => {
  const modal = document.getElementById('cardModal');
  const title = document.getElementById('modalTitle');
  const selection = document.getElementById('cardSelection');
  
  title.textContent = `‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏ã‡∏ï 2 ‡πÉ‡∏ö‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö ${markerCard.label}`;
  selection.innerHTML = '';
  
  const setCards = gameState.players[gameState.currentPlayer].hand
    .map((card, index) => ({card, index}))
    .filter(item => item.card.type === 'set');
  
  let selectedSets = [];
  
  setCards.forEach(item => {
    const cardElement = document.createElement('div');
    cardElement.className = 'card set';
    cardElement.onclick = () => {
      const isSelected = selectedSets.includes(item.index);
      if(isSelected) {
        selectedSets = selectedSets.filter(i => i !== item.index);
        cardElement.classList.remove('selected');
      } else if(selectedSets.length < 2) {
        selectedSets.push(item.index);
        cardElement.classList.add('selected');
      }
    };
    
    // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏•‡∏±‡∏Å
    const labelDiv = document.createElement('div');
    labelDiv.textContent = item.card.label;
    cardElement.appendChild(labelDiv);
    
    // ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà
    const detailsDiv = document.createElement('div');
    detailsDiv.className = 'card-details';
    detailsDiv.textContent = `‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà: ${item.card.cells.join(', ')}`;
    cardElement.appendChild(detailsDiv);
    
    selection.appendChild(cardElement);
  });
  
  document.getElementById('modalConfirm').onclick = () => {
    if(selectedSets.length !== 2) {
      alert('‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏ã‡∏ï 2 ‡πÉ‡∏ö!');
      return;
    }
    
    modal.style.display = 'none';
    applyMarkerCard(markerCard, selectedSets);
  };
  
  document.getElementById('modalCancel').onclick = () => {
    modal.style.display = 'none';
  };
  
  modal.style.display = 'block';
};

// ‡πÉ‡∏ä‡πâ‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏ã‡∏ï‡∏Å‡∏±‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏π‡πà (‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô)
const applySetWithMarker = (setCard, markerCard, conflicts) => {
  let resultCells = [];
  const opponentColor = gameState.currentPlayer === 'black' ? 'white' : 'black';
  
  switch(markerCard.subtype) {
    case 'union':
      // Union: ‡∏¢‡∏∂‡∏î‡∏Ñ‡∏£‡∏≠‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏ã‡∏ï + ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ô‡∏Ç‡∏≠‡∏á‡∏ù‡∏±‡πà‡∏á‡∏ï‡∏£‡∏á‡∏Ç‡πâ‡∏≤‡∏°
      resultCells = [...setCard.cells];
      
      // ‡∏´‡∏≤‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ô‡∏Ç‡∏≠‡∏á‡∏ù‡∏±‡πà‡∏á‡∏ï‡∏£‡∏á‡∏Ç‡πâ‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ï‡∏¥‡∏î‡∏Å‡∏±‡∏ö‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏´‡∏°‡πà
      const adjacentOpponentTokens = new Set();
      setCard.cells.forEach(pos => {
        const adjacent = getAdjacentCells(pos);
        adjacent.forEach(adjPos => {
          if (gameState.board[adjPos] === opponentColor) {
            adjacentOpponentTokens.add(adjPos);
          }
        });
      });
      
      // ‡∏´‡∏≤‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Ç‡∏≠‡∏á‡∏ù‡∏±‡πà‡∏á‡∏ï‡∏£‡∏á‡∏Ç‡πâ‡∏≤‡∏°
      if (adjacentOpponentTokens.size > 0) {
        const connectedOpponentArea = getConnectedArea(Array.from(adjacentOpponentTokens), opponentColor);
        resultCells = [...resultCells, ...connectedOpponentArea];
      }
      
      // ‡∏•‡∏ö‡∏Ñ‡πà‡∏≤‡∏ã‡πâ‡∏≥
      resultCells = [...new Set(resultCells)];
      break;
      
    case 'intersection':
      // Intersection: ‡∏¢‡∏∂‡∏î‡∏Ñ‡∏£‡∏≠‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô (‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÄ‡∏™‡∏ñ‡∏µ‡∏¢‡∏£‡∏†‡∏≤‡∏û)
      resultCells = [...conflicts];
      break;
      
    case 'difference':
      // Difference: ‡∏ô‡∏≥‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏Ç‡∏≠‡∏á‡∏ù‡∏±‡πà‡∏á‡∏ï‡∏£‡∏á‡∏Ç‡πâ‡∏≤‡∏°‡πÉ‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°
      const overlappingOpponentCells = setCard.cells.filter(pos => 
        gameState.board[pos] && gameState.board[pos] !== gameState.currentPlayer
      );
      
      if (overlappingOpponentCells.length === 0) {
        alert('‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏Ç‡∏≠‡∏á‡∏ù‡∏±‡πà‡∏á‡∏ï‡∏£‡∏á‡∏Ç‡πâ‡∏≤‡∏°‡πÉ‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πâ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö‡πÑ‡∏î‡πâ!');
        
        // ‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á‡πÉ‡∏ö‡πÅ‡∏°‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
        const setIndex = gameState.selectedCards.find(i => gameState.players[gameState.currentPlayer].hand[i].type === 'set');
        const markerIndex = gameState.selectedCards.find(i => gameState.players[gameState.currentPlayer].hand[i].type === 'marker');
        const allIndices = [setIndex, markerIndex].sort((a, b) => b - a);
        allIndices.forEach(index => gameState.players[gameState.currentPlayer].hand.splice(index, 1));
        
        gameState.selectedCards = [];
        updateDisplay();
        return;
      }
      
      // ‡∏•‡∏ö‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏Ç‡∏≠‡∏á‡∏ù‡∏±‡πà‡∏á‡∏ï‡∏£‡∏á‡∏Ç‡πâ‡∏≤‡∏°‡πÉ‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô
      overlappingOpponentCells.forEach(pos => {
        delete gameState.board[pos];
        const cell = document.querySelector(`[data-position="${pos}"]`);
        if(cell) {
          cell.innerHTML = pos;
          cell.style.backgroundColor = 'white';
        }
      });
      
      // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏´‡∏•‡∏±‡∏á‡∏•‡∏ö
      updateTokenCounts();
      
      // ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏° - ‡πÅ‡∏Ñ‡πà‡∏•‡∏ö‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏ù‡∏±‡πà‡∏á‡∏ï‡∏£‡∏á‡∏Ç‡πâ‡∏≤‡∏°
      resultCells = [];
      break;
  }
  
  // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Difference ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏° ‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ô‡∏µ‡πâ
  if(markerCard.subtype !== 'difference' && (!resultCells || resultCells.length === 0)) {
    alert(`‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ ${markerCard.label} ‡∏Å‡∏±‡∏ö ${setCard.label} ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ä‡πà‡∏≠‡∏á‡πÉ‡∏î‡πÜ!`);
    return;
  }
  
  // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á
  const validCells = resultCells.filter(pos => {
    const letter = pos.charAt(0);
    const number = parseInt(pos.charAt(1));
    return letter >= 'A' && letter <= 'H' && number >= 1 && number <= 8;
  });
  
  if(validCells.length !== resultCells.length) {
    alert('‡∏û‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£!');
    return;
  }
  
  resultCells = validCells;
  
  // ‡∏ß‡∏≤‡∏á‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏ï‡∏≤‡∏°‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå (‡∏¢‡∏Å‡πÄ‡∏ß‡πâ‡∏ô Difference ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°)
  if(markerCard.subtype !== 'difference') {
    const originalTokens = resultCells.filter(pos => gameState.board[pos] === gameState.currentPlayer).length;
    const capturedTokens = resultCells.filter(pos => gameState.board[pos] && gameState.board[pos] !== gameState.currentPlayer).length;
    
    resultCells.forEach(pos => {
      gameState.board[pos] = gameState.currentPlayer;
      const cell = document.querySelector(`[data-position="${pos}"]`);
      if(cell) {
        const chip = document.createElement('div');
        chip.className = `chip ${gameState.currentPlayer}`;
        chip.textContent = gameState.currentPlayer === 'black' ? '‚ö´' : '‚ö™';
        cell.innerHTML = '';
        cell.appendChild(chip);
        
        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏≠‡∏á
        cell.style.backgroundColor = gameState.currentPlayer === 'black' ? '#f3f4f6' : '#fef3c7';
      }
    });
    
    updateTokenCounts();
  }
  gameState.cardsPlacedThisTurn.set = true;
  gameState.cardsPlacedThisTurn.marker = true;
  
  // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Difference ‡∏à‡∏∞‡∏°‡∏µ‡∏Å‡∏≤‡∏£ log ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡πÄ‡∏ö‡∏µ‡πâ‡∏¢
  if(markerCard.subtype !== 'difference') {
    const playerName = gameState.currentPlayer === 'black' ? '‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏î‡∏≥' : '‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏Ç‡∏≤‡∏ß';
    let logMsg = `${playerName} ‡πÉ‡∏ä‡πâ ${setCard.label} + ${markerCard.label} ‡πÑ‡∏î‡πâ ${resultCells.length} ‡∏ä‡πà‡∏≠‡∏á`;
    if (markerCard.subtype === 'union' && capturedTokens > 0) {
      logMsg += ` (‡∏£‡∏ß‡∏°‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏ï‡∏¥‡∏î‡∏Å‡∏±‡∏ô ${capturedTokens} ‡∏ä‡πà‡∏≠‡∏á)`;
    }
    logMessage(logMsg);
  }
  
  // ‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á‡πÉ‡∏ö
  const setIndex = gameState.selectedCards.find(i => gameState.players[gameState.currentPlayer].hand[i].type === 'set');
  const markerIndex = gameState.selectedCards.find(i => gameState.players[gameState.currentPlayer].hand[i].type === 'marker');
  const allIndices = [setIndex, markerIndex].sort((a, b) => b - a);
  allIndices.forEach(index => gameState.players[gameState.currentPlayer].hand.splice(index, 1));
  
  gameState.selectedCards = [];
  updateDisplay();
  
  updateGameStatus('‡∏Å‡∏î‡∏Ç‡πâ‡∏≤‡∏°‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏ö‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô');
  enableButtons(['skipTurnBtn']);
};

// ‡πÉ‡∏ä‡πâ‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢
const applyMarkerCard = (markerCard, setIndices) => {
  const hand = gameState.players[gameState.currentPlayer].hand;
  const set1 = hand[setIndices[0]];
  const set2 = hand[setIndices[1]];
  
  let resultCells = [];
  
  try {
    switch(markerCard.subtype) {
      case 'union':
        // Union: ‡∏£‡∏ß‡∏°‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏ã‡∏ï
        const combinedCells = [...set1.cells, ...set2.cells];
        resultCells = [...new Set(combinedCells)];
        
        // ‡∏´‡∏≤‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏Ç‡∏≠‡∏á‡∏ù‡∏±‡πà‡∏á‡∏ï‡∏£‡∏á‡∏Ç‡πâ‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏¥‡∏î‡∏Å‡∏±‡∏ö‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏´‡∏°‡πà
        const opponentColor = gameState.currentPlayer === 'black' ? 'white' : 'black';
        const adjacentOpponentTokens = new Set();
        
        resultCells.forEach(pos => {
          const adjacent = getAdjacentCells(pos);
          adjacent.forEach(adjPos => {
            if (gameState.board[adjPos] === opponentColor) {
              adjacentOpponentTokens.add(adjPos);
            }
          });
        });
        
        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ô‡∏Ç‡∏≠‡∏á‡∏ù‡∏±‡πà‡∏á‡∏ï‡∏£‡∏á‡∏Ç‡πâ‡∏≤‡∏°
        if (adjacentOpponentTokens.size > 0) {
          const connectedOpponentArea = getConnectedArea(Array.from(adjacentOpponentTokens), opponentColor);
          resultCells = [...new Set([...resultCells, ...connectedOpponentArea])];
        }
        break;
        
      case 'intersection':
        // Intersection: ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡∏ó‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡∏Å‡∏±‡∏ô (‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÄ‡∏™‡∏ñ‡∏µ‡∏¢‡∏£‡∏†‡∏≤‡∏û)
        resultCells = set1.cells.filter(cell => set2.cells.includes(cell));
        if (resultCells.length === 0) {
          throw new Error('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡∏ó‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡∏Å‡∏±‡∏ô');
        }
        break;
        
      case 'difference':
        // Difference: ‡∏ô‡∏≥‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏Ç‡∏≠‡∏á‡∏ù‡∏±‡πà‡∏á‡∏ï‡∏£‡∏á‡∏Ç‡πâ‡∏≤‡∏°‡πÉ‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡∏ó‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡∏Å‡∏±‡∏ô‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏ã‡∏ï 1 ‡πÅ‡∏•‡∏∞ ‡πÄ‡∏ã‡∏ï 2 ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°
        const opponentColorDiff = gameState.currentPlayer === 'black' ? 'white' : 'black';
        
        // ‡∏´‡∏≤‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡∏ó‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡∏Å‡∏±‡∏ô‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏ã‡∏ï 1 ‡πÅ‡∏•‡∏∞ ‡πÄ‡∏ã‡∏ï 2
        const overlappingCells = set1.cells.filter(cell => set2.cells.includes(cell));
        
        if (overlappingCells.length === 0) {
          throw new Error('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡∏ó‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡∏Å‡∏±‡∏ô‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏ã‡∏ï‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á');
        }
        
        // ‡∏´‡∏≤‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏Ç‡∏≠‡∏á‡∏ù‡∏±‡πà‡∏á‡∏ï‡∏£‡∏á‡∏Ç‡πâ‡∏≤‡∏°‡πÉ‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡∏ó‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô
        const opponentTokensInOverlap = overlappingCells.filter(pos => 
          gameState.board[pos] === opponentColorDiff
        );
        
        if (opponentTokensInOverlap.length === 0) {
          throw new Error('‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏Ç‡∏≠‡∏á‡∏ù‡∏±‡πà‡∏á‡∏ï‡∏£‡∏á‡∏Ç‡πâ‡∏≤‡∏°‡πÉ‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡∏ó‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡∏Å‡∏±‡∏ô');
        }
        
        // ‡∏•‡∏ö‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏Ç‡∏≠‡∏á‡∏ù‡∏±‡πà‡∏á‡∏ï‡∏£‡∏á‡∏Ç‡πâ‡∏≤‡∏°‡πÉ‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡∏ó‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô
        opponentTokensInOverlap.forEach(pos => {
          delete gameState.board[pos];
          const cell = document.querySelector(`[data-position="${pos}"]`);
          if(cell) {
            cell.innerHTML = pos;
            cell.style.backgroundColor = 'white';
          }
        });
        
        // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏´‡∏•‡∏±‡∏á‡∏•‡∏ö
        updateTokenCounts();
        
        // ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏° - ‡πÅ‡∏Ñ‡πà‡∏•‡∏ö‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏ù‡∏±‡πà‡∏á‡∏ï‡∏£‡∏á‡∏Ç‡πâ‡∏≤‡∏°
        resultCells = [];
        
        // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥
        const playerName = gameState.currentPlayer === 'black' ? '‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏î‡∏≥' : '‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏Ç‡∏≤‡∏ß';
        logMessage(`${playerName} ‡πÉ‡∏ä‡πâ ${markerCard.label} ‡∏Å‡∏±‡∏ö ${set1.label} ‡πÅ‡∏•‡∏∞ ${set2.label} ‡∏•‡∏ö‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏ù‡∏±‡πà‡∏á‡∏ï‡∏£‡∏á‡∏Ç‡πâ‡∏≤‡∏° ${opponentTokensInOverlap.length} ‡∏ä‡πà‡∏≠‡∏á: ${opponentTokensInOverlap.join(', ')}`);
        break;
        
      case 'complement':
        // Complement: ‡πÑ‡∏î‡πâ‡∏ó‡∏∏‡∏Å‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏Å‡πÄ‡∏ß‡πâ‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏∏‡πÇ‡∏î‡∏¢‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏ã‡∏ï
        const allCells = [];
        for (let row = 0; row < 8; row++) {
          for (let col = 0; col < 8; col++) {
            allCells.push(`${String.fromCharCode(65 + row)}${col + 1}`);
          }
        }
        
        // ‡∏£‡∏ß‡∏°‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏ã‡∏ï‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á
        const combinedSetCells = [...new Set([...set1.cells, ...set2.cells])];
        
        // ‡∏´‡∏≤‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà complement (‡∏ó‡∏∏‡∏Å‡∏ó‡∏µ‡πà‡∏¢‡∏Å‡πÄ‡∏ß‡πâ‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏ã‡∏ï)
        resultCells = allCells.filter(pos => !combinedSetCells.includes(pos));
        break;
        
    }
  } catch (error) {
    alert(`‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ ${markerCard.label} ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏≥‡πÑ‡∏î‡πâ: ${error.message}`);
    
    // ‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÅ‡∏°‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
    const markerIndex = gameState.selectedCards.find(i => hand[i].type === 'marker');
    const allIndices = [markerIndex, ...setIndices].sort((a, b) => b - a);
    allIndices.forEach(index => hand.splice(index, 1));
    
    gameState.selectedCards = [];
    updateDisplay();
    return;
  }
  
  // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Difference ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏° ‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ô‡∏µ‡πâ
  if(markerCard.subtype !== 'difference' && (!resultCells || resultCells.length === 0)) {
    alert(`‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ ${markerCard.label} ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ä‡πà‡∏≠‡∏á‡πÉ‡∏î‡πÜ!`);
    
    // ‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÅ‡∏°‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
    const markerIndex = gameState.selectedCards.find(i => hand[i].type === 'marker');
    const allIndices = [markerIndex, ...setIndices].sort((a, b) => b - a);
    allIndices.forEach(index => hand.splice(index, 1));
    
    gameState.selectedCards = [];
    updateDisplay();
    return;
  }
  
  // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á
  const validCells = resultCells.filter(pos => {
    if (typeof pos !== 'string' || pos.length !== 2) return false;
    const letter = pos.charAt(0);
    const number = parseInt(pos.charAt(1));
    return letter >= 'A' && letter <= 'H' && number >= 1 && number <= 8;
  });
  
  if(validCells.length !== resultCells.length) {
    alert('‡∏û‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£!');
    
    // ‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÅ‡∏°‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
    const markerIndex = gameState.selectedCards.find(i => hand[i].type === 'marker');
    const allIndices = [markerIndex, ...setIndices].sort((a, b) => b - a);
    allIndices.forEach(index => hand.splice(index, 1));
    
    gameState.selectedCards = [];
    updateDisplay();
    return;
  }
  
  resultCells = validCells;
  
  // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô (‡∏¢‡∏Å‡πÄ‡∏ß‡πâ‡∏ô Union ‡πÅ‡∏•‡∏∞ Difference ‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏≠‡∏á‡πÑ‡∏î‡πâ)
  if(markerCard.subtype !== 'difference') {
    const conflicts = resultCells.filter(pos => gameState.board[pos] && gameState.board[pos] !== gameState.currentPlayer);
    
    if(conflicts.length > 0 && markerCard.subtype !== 'union') {
      alert(`‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏Å‡∏≤‡∏£‡πå‡∏î ${markerCard.label} ‡πÑ‡∏î‡πâ ‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡∏°‡∏µ‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏Ç‡∏≠‡∏á‡∏ù‡∏±‡πà‡∏á‡∏ï‡∏£‡∏á‡∏Ç‡πâ‡∏≤‡∏°‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà: ${conflicts.join(', ')}`);
      
      // ‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÅ‡∏°‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
      const markerIndex = gameState.selectedCards.find(i => hand[i].type === 'marker');
      const allIndices = [markerIndex, ...setIndices].sort((a, b) => b - a);
      allIndices.forEach(index => hand.splice(index, 1));
      
      gameState.selectedCards = [];
      updateDisplay();
      return;
    }
  }
  
  // ‡∏ß‡∏≤‡∏á‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏ï‡∏≤‡∏°‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå (‡∏¢‡∏Å‡πÄ‡∏ß‡πâ‡∏ô Difference ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°)
  if(markerCard.subtype !== 'difference') {
    const originalTokens = resultCells.filter(pos => gameState.board[pos] === gameState.currentPlayer).length;
    const conflicts = resultCells.filter(pos => gameState.board[pos] && gameState.board[pos] !== gameState.currentPlayer);
    const capturedTokens = conflicts.length;
    
    placeTokens(resultCells, gameState.currentPlayer);
    
    const playerName = gameState.currentPlayer === 'black' ? '‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏î‡∏≥' : '‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏Ç‡∏≤‡∏ß';
    let logMsg = `${playerName} ‡πÉ‡∏ä‡πâ ${markerCard.label} ‡∏Å‡∏±‡∏ö ${set1.label} ‡πÅ‡∏•‡∏∞ ${set2.label} ‡πÑ‡∏î‡πâ ${resultCells.length} ‡∏ä‡πà‡∏≠‡∏á`;
    if (markerCard.subtype === 'union' && capturedTokens > 0) {
      logMsg += ` (‡∏¢‡∏∂‡∏î‡∏Ñ‡∏£‡∏≠‡∏á ${capturedTokens} ‡∏ä‡πà‡∏≠‡∏á)`;
    }
    logMessage(logMsg);
  }
  
  gameState.cardsPlacedThisTurn.marker = true;
  
  // ‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ
  const markerIndex = gameState.selectedCards.find(i => hand[i].type === 'marker');
  const allIndices = [markerIndex, ...setIndices].sort((a, b) => b - a);
  allIndices.forEach(index => hand.splice(index, 1));
  
  gameState.selectedCards = [];
  updateDisplay();
  
  // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏î‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
  const canPlaceMore = !gameState.cardsPlacedThisTurn.set && hand.some(c => c.type === 'set');
  
  if(canPlaceMore) {
    updateGameStatus('‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏ã‡∏ï‡πÑ‡∏î‡πâ‡∏≠‡∏µ‡∏Å 1 ‡πÉ‡∏ö ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏¥‡πâ‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î/‡∏Ç‡πâ‡∏≤‡∏°‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô');
    enableButtons(['placeCardsBtn', 'discardBtn', 'skipTurnBtn']);
  } else {
    // ‡∏à‡∏ö‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß
    setTimeout(() => {
      skipTurn();
    }, 1000);
    updateGameStatus('‡πÉ‡∏ä‡πâ‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß - ‡∏à‡∏∞‡∏à‡∏ö‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô‡πÉ‡∏ô‡∏≠‡∏µ‡∏Å 1 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ...');
    enableButtons([]);
  }
};

// ‡∏ó‡∏¥‡πâ‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î
const discardCard = () => {
  if(gameState.turnPhase !== 'action') {
    alert('‡∏ï‡πâ‡∏≠‡∏á‡∏à‡∏±‡πà‡∏ß‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏ó‡∏¥‡πâ‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î!');
    return;
  }
  
  if(gameState.selectedCards.length !== 1) {
    alert('‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡πå‡∏î 1 ‡πÉ‡∏ö‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏¥‡πâ‡∏á!');
    return;
  }
  
  const cardIndex = gameState.selectedCards[0];
  const card = gameState.players[gameState.currentPlayer].hand[cardIndex];
  
  gameState.players[gameState.currentPlayer].hand.splice(cardIndex, 1);
  gameState.selectedCards = [];
  
  const playerName = getPlayerName(gameState.currentPlayer);
  logMessage(`${playerName} ‡∏ó‡∏¥‡πâ‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î: ${card.label}`);
  
  updateDisplay();
  
  // ‡∏à‡∏ö‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á‡∏ó‡∏¥‡πâ‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î
  const delay = gameState.players[gameState.currentPlayer].isAI ? 300 : 1000;
  setTimeout(() => {
    skipTurn();
  }, delay);
  
  const message = gameState.players[gameState.currentPlayer].isAI ?
    'AI ‡∏ó‡∏¥‡πâ‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÅ‡∏•‡πâ‡∏ß - ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏ö‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô...' :
    '‡∏ó‡∏¥‡πâ‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÅ‡∏•‡πâ‡∏ß - ‡∏à‡∏∞‡∏à‡∏ö‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô‡πÉ‡∏ô‡∏≠‡∏µ‡∏Å 1 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ...';
  updateGameStatus(message);
  enableButtons([]);
};

// ‡∏Ç‡πâ‡∏≤‡∏°‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô
const skipTurn = () => {
  if(gameState.phase === 'playing' && gameState.turnPhase === 'draw' && !gameState.drawnThisTurn) {
    alert('‡∏ï‡πâ‡∏≠‡∏á‡∏à‡∏±‡πà‡∏ß‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≤‡∏°‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô!');
    return;
  }
  
  const playerName = gameState.currentPlayer === 'black' ? '‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏î‡∏≥' : '‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏Ç‡∏≤‡∏ß';
  
  if(gameState.phase === 'playing') {
    // ‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á action ‡πÉ‡∏´‡πâ‡∏à‡∏ö‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
    if(gameState.turnPhase === 'action') {
      logMessage(`${playerName} ‡∏Ç‡πâ‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå`);
    } else {
      logMessage(`${playerName} ‡∏à‡∏ö‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô`);
    }
    
    logMessage(`${playerName} ‡∏à‡∏ö‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô`);
    
    // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô
    gameState.currentPlayer = gameState.currentPlayer === 'black' ? 'white' : 'black';
    if(gameState.currentPlayer === 'black') {
      gameState.turn++;
    }
    
    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏à‡∏ö‡πÄ‡∏Å‡∏°
    if(gameState.turn > 20) {
      endGame();
      return;
    }
    
    // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô
    gameState.turnPhase = 'draw';
    gameState.drawnThisTurn = false;
    gameState.cardsPlacedThisTurn = { set: false, marker: false };
    gameState.selectedCards = [];
    
    updateDisplay();
    
    const nextPlayerName = getPlayerName(gameState.currentPlayer);
    
    if (gameState.players[gameState.currentPlayer].isAI) {
      updateGameStatus(`${nextPlayerName} ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡∏¥‡∏î...`);
      setTimeout(() => aiMove(), 300); // ‡∏•‡∏î‡πÄ‡∏õ‡πá‡∏ô 300ms ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
    } else {
      updateGameStatus(`${nextPlayerName}: ‡∏à‡∏±‡πà‡∏ß‡∏Å‡∏≤‡∏£‡πå‡∏î 1 ‡πÉ‡∏ö‡∏Å‡πà‡∏≠‡∏ô`);
      enableButtons(['drawSetBtn', 'drawMarkerBtn']);
    }
  }
};

// ‡∏à‡∏ö‡πÄ‡∏Å‡∏°
const endGame = () => {
  gameState.phase = 'finished';
  
  const blackScore = calculateScore('black');
  const whiteScore = calculateScore('white');
  
  const blackPlayerName = getPlayerName('black');
  const whitePlayerName = getPlayerName('white');
  
  let winner, message;
  if(blackScore > whiteScore) {
    winner = `${blackPlayerName}‡∏ä‡∏ô‡∏∞!`;
    message = `üéâ ${blackPlayerName}‡∏ä‡∏ô‡∏∞! (${blackScore} > ${whiteScore})`;
  } else if(whiteScore > blackScore) {
    winner = `${whitePlayerName}‡∏ä‡∏ô‡∏∞!`;
    message = `üéâ ${whitePlayerName}‡∏ä‡∏ô‡∏∞! (${whiteScore} > ${blackScore})`;
  } else {
    winner = '‡πÄ‡∏™‡∏°‡∏≠‡∏Å‡∏±‡∏ô!';
    message = `ü§ù ‡πÄ‡∏™‡∏°‡∏≠‡∏Å‡∏±‡∏ô! (${blackScore} = ${whiteScore})`;
  }
  
  logMessage('üèÅ ‡∏à‡∏ö‡πÄ‡∏Å‡∏°! ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô:');
  logMessage(`   ${blackPlayerName}: ${blackScore} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô (‡πÄ‡∏ö‡∏µ‡πâ‡∏¢ ${gameState.players.black.tokens} - ‡∏Å‡∏≤‡∏£‡πå‡∏î ${gameState.players.black.hand.length})`);
  logMessage(`   ${whitePlayerName}: ${whiteScore} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô (‡πÄ‡∏ö‡∏µ‡πâ‡∏¢ ${gameState.players.white.tokens} - ‡∏Å‡∏≤‡∏£‡πå‡∏î ${gameState.players.white.hand.length})`);
  logMessage(message);
  
  updateDisplay();
  updateGameStatus('‡πÄ‡∏Å‡∏°‡∏à‡∏ö‡πÅ‡∏•‡πâ‡∏ß! ‡∏Å‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á');
  enableButtons([]);
};

// Event Listeners
document.getElementById('newGameBtn').onclick = startNewGame;
document.getElementById('drawSetBtn').onclick = drawSetCard;
document.getElementById('drawMarkerBtn').onclick = drawMarkerCard;
document.getElementById('placeCardsBtn').onclick = placeCards;
document.getElementById('discardBtn').onclick = discardCard;
document.getElementById('skipTurnBtn').onclick = skipTurn;

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á/‡∏ã‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πå‡∏î
const toggleCardInfo = () => {
  const content = document.getElementById('card-info-content');
  const icon = document.getElementById('toggle-icon');
  const text = document.getElementById('toggle-text');
  
  if (content.classList.contains('show')) {
    content.classList.remove('show');
    icon.textContent = 'üëÅÔ∏è';
    text.textContent = '‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πå‡∏î';
  } else {
    content.classList.add('show');
    icon.textContent = 'üôà';
    text.textContent = '‡∏ã‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πå‡∏î';
  }
};

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠
const updateCardCounts = () => {
  const setElement = document.getElementById('remaining-set-cards');
  const markerElement = document.getElementById('remaining-marker-cards');
  
  if (setElement && gameState && gameState.deckSet) {
    setElement.textContent = `‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÉ‡∏ô‡πÄ‡∏î‡πá‡∏Ñ: ${gameState.deckSet.length} ‡πÉ‡∏ö`;
  }
  
  if (markerElement && gameState && gameState.deckMarker) {
    markerElement.textContent = `‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÉ‡∏ô‡πÄ‡∏î‡πá‡∏Ñ: ${gameState.deckMarker.length} ‡πÉ‡∏ö`;
  }
};

// AI Logic
const aiMove = () => {
  if (gameState.phase === 'finished' || !gameState.players[gameState.currentPlayer].isAI) {
    return;
  }
  
  if (gameState.phase === 'pregame') {
    aiPregameMove();
  } else if (gameState.phase === 'playing') {
    aiPlayingMove();
  }
};

const aiPregameMove = () => {
  const currentPlayerHand = gameState.players[gameState.currentPlayer].hand;
  let setCards = currentPlayerHand.filter(c => c.type === 'set' && c.cells && c.cells.length > 0);
  
  if (setCards.length > 0) {
    // ‡∏´‡∏≤‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥‡∏Å‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡∏ö‡∏ô‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏á)
    let validCard = null;
    let cardIndex = -1;
    
    if (gameState.currentPlayer === 'white') {
      // ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏á‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏≤‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥
      for (let i = 0; i < setCards.length; i++) {
        const card = setCards[i];
        const conflicts = card.cells.filter(pos => gameState.board[pos]);
        
        if (conflicts.length === 0) {
          validCard = card;
          cardIndex = currentPlayerHand.indexOf(card);
          break;
        }
      }
      
      // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏° ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Å‡∏≤‡∏£‡πå‡∏î
      if (!validCard) {
        const firstCard = setCards[0];
        cardIndex = currentPlayerHand.indexOf(firstCard);
        gameState.selectedCards = [cardIndex];
        
        // AI ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
        changeCardFromDeck();
        return;
      }
    } else {
      // ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÅ‡∏£‡∏Å ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÉ‡∏î‡∏Å‡πá‡πÑ‡∏î‡πâ
      validCard = setCards[0];
      cardIndex = currentPlayerHand.indexOf(validCard);
    }
    
    // ‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡πå‡∏î
    gameState.selectedCards = [cardIndex];
    
    // AI ‡∏ó‡∏≥‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏≠
    placePregameCard();
  }
};

const aiPlayingMove = () => {
  if (gameState.turnPhase === 'draw') {
    // AI ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏±‡πà‡∏ß‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ä‡∏≤‡∏ç‡∏â‡∏•‡∏≤‡∏î
    const decision = makeSmartDrawDecision();
    const playerName = getPlayerName(gameState.currentPlayer);
    
    setTimeout(() => {
      if (decision === 'marker' && gameState.deckMarker.length > 0) {
        logMessage(`${playerName} ‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à‡∏à‡∏±‡πà‡∏ß‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢ (‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏°‡∏≤‡∏£‡πå‡∏Ñ‡πÄ‡∏Å‡∏≠‡∏£‡πå)`);
        drawMarkerCard();
      } else if (decision === 'set' && gameState.deckSet.length > 0) {
        logMessage(`${playerName} ‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à‡∏à‡∏±‡πà‡∏ß‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏ã‡∏ï (‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°)`);
        drawSetCard();
      } else {
        // ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏Ñ‡∏∏‡πâ‡∏°
        logMessage(`${playerName} ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÉ‡∏´‡πâ‡∏à‡∏±‡πà‡∏ß - ‡∏Ç‡πâ‡∏≤‡∏°‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô`);
        skipTurn();
      }
    }, 200);
    
  } else if (gameState.turnPhase === 'action') {
    // AI ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î
    const bestAction = chooseBestAction();
    
    setTimeout(() => {
      executeBestAction(bestAction);
    }, 300);
  }
};

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à‡∏à‡∏±‡πà‡∏ß‡∏Å‡∏≤‡∏£‡πå‡∏î
const makeSmartDrawDecision = () => {
  const currentPlayerHand = gameState.players[gameState.currentPlayer].hand;
  const setCards = currentPlayerHand.filter(c => c.type === 'set');
  const markerCards = currentPlayerHand.filter(c => c.type === 'marker');
  
  // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏ã‡∏ï‡πÅ‡∏•‡πâ‡∏ß ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢ ‡∏Ñ‡∏ß‡∏£‡∏à‡∏±‡πà‡∏ß‡∏°‡∏≤‡∏£‡πå‡∏Ñ‡πÄ‡∏Å‡∏≠‡∏£‡πå
  if (setCards.length > 0 && markerCards.length === 0 && gameState.deckMarker.length > 0) {
    return 'marker';
  }
  
  // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß ‡πÅ‡∏ï‡πà‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏ã‡∏ï‡∏ô‡πâ‡∏≠‡∏¢ ‡∏Ñ‡∏ß‡∏£‡∏à‡∏±‡πà‡∏ß‡πÄ‡∏ã‡∏ï
  if (markerCards.length > 0 && setCards.length < 2 && gameState.deckSet.length > 0) {
    return 'set';
  }
  
  // ‡∏Å‡∏£‡∏ì‡∏µ‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≤‡∏°‡πÇ‡∏≠‡∏Å‡∏≤‡∏™
  if (gameState.deckSet.length > gameState.deckMarker.length) {
    return 'set';
  } else if (gameState.deckMarker.length > 0) {
    return 'marker';
  } else {
    return 'set';
  }
};

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î
const chooseBestAction = () => {
  const currentPlayerHand = gameState.players[gameState.currentPlayer].hand;
  const setCards = currentPlayerHand.filter(c => c.type === 'set');
  const markerCards = currentPlayerHand.filter(c => c.type === 'marker');
  
  // ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡πà‡∏≤‡∏á‡πÜ
  const actions = [];
  
  // 1. ‡∏•‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏ã‡∏ï‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤ (‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥)
  if (!gameState.cardsPlacedThisTurn.set) {
    setCards.forEach(card => {
      if (card.subtype !== 'empty' && card.cells && card.cells.length > 0) {
        const conflicts = card.cells.filter(pos => gameState.board[pos] && gameState.board[pos] !== gameState.currentPlayer);
        if (conflicts.length === 0) {
          // ‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥ = ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏π‡∏á
          actions.push({
            type: 'placeSet',
            card: card,
            score: card.cells.length * 10, // ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ï‡∏≤‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ä‡πà‡∏≠‡∏á
            cardIndex: currentPlayerHand.indexOf(card)
          });
        }
      }
    });
  }
  
  // 2. ‡∏•‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏ã‡∏ï + ‡∏°‡∏≤‡∏£‡πå‡∏Ñ‡πÄ‡∏Å‡∏≠‡∏£‡πå (‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ã‡πâ‡∏≥)
  if (!gameState.cardsPlacedThisTurn.set && markerCards.length > 0) {
    setCards.forEach(setCard => {
      if (setCard.subtype !== 'empty' && setCard.cells && setCard.cells.length > 0) {
        const conflicts = setCard.cells.filter(pos => gameState.board[pos] && gameState.board[pos] !== gameState.currentPlayer);
        if (conflicts.length > 0) {
          markerCards.forEach(markerCard => {
            const comboScore = evaluateSetMarkerCombo(setCard, markerCard);
            if (comboScore > 0) {
              actions.push({
                type: 'placeSetWithMarker',
                setCard: setCard,
                markerCard: markerCard,
                score: comboScore,
                setIndex: currentPlayerHand.indexOf(setCard),
                markerIndex: currentPlayerHand.indexOf(markerCard)
              });
            }
          });
        }
      }
    });
  }
  
  // 3. ‡∏ó‡∏¥‡πâ‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏î‡∏µ
  const badCards = currentPlayerHand.filter(card => {
    if (card.type === 'set' && card.subtype === 'empty') return true; // Empty Set ‡∏¢‡∏≤‡∏Å
    if (card.type === 'set' && (!card.cells || card.cells.length <= 1)) return true; // ‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏•‡πá‡∏Å
    return false;
  });
  
  if (badCards.length > 0) {
    actions.push({
      type: 'discard',
      card: badCards[0],
      score: 5, // ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ï‡πà‡∏≥ ‡πÅ‡∏ï‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
      cardIndex: currentPlayerHand.indexOf(badCards[0])
    });
  }
  
  // 4. ‡∏Ç‡πâ‡∏≤‡∏°‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô (‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢)
  actions.push({
    type: 'skip',
    score: 1
  });
  
  // ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î
  return actions.sort((a, b) => b.score - a.score)[0];
};

// ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏ß‡∏°‡∏Å‡∏±‡∏ô‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏ã‡∏ï‡πÅ‡∏•‡∏∞‡∏°‡∏≤‡∏£‡πå‡∏Ñ‡πÄ‡∏Å‡∏≠‡∏£‡πå
const evaluateSetMarkerCombo = (setCard, markerCard) => {
  if (!setCard.cells || setCard.cells.length === 0) return 0;
  
  let score = setCard.cells.length * 5; // ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏à‡∏≤‡∏Å‡∏Ç‡∏ô‡∏≤‡∏î
  
  // ‡πÇ‡∏ö‡∏ô‡∏±‡∏™‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏°‡∏≤‡∏£‡πå‡∏Ñ‡πÄ‡∏Å‡∏≠‡∏£‡πå
  switch (markerCard.subtype) {
    case 'union':
      score += 15; // Union ‡πÉ‡∏´‡πâ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°
      break;
    case 'intersection':
      score += 10; // Intersection ‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á
      break;
    case 'difference':
      score += 12; // Difference ‡∏•‡∏ö‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏Ñ‡∏π‡πà‡πÅ‡∏Ç‡πà‡∏á
      break;
    case 'complement':
      score += 8; // Complement ‡∏¢‡∏≤‡∏ß‡∏ô‡∏≤‡∏ô
      break;
  }
  
  return score;
};

// ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
const executeBestAction = (action) => {
  // ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡∏Ç‡∏≠‡∏á AI
  const playerName = getPlayerName(gameState.currentPlayer);
  
  switch (action.type) {
    case 'placeSet':
      logMessage(`${playerName} ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏•‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏ã‡∏ï: ${action.card.label} (‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô ${action.score})`);
      gameState.selectedCards = [action.cardIndex];
      placeCards();
      break;
      
    case 'placeSetWithMarker':
      logMessage(`${playerName} ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏•‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏ã‡∏ï + ‡∏°‡∏≤‡∏£‡πå‡∏Ñ‡πÄ‡∏Å‡∏≠‡∏£‡πå: ${action.setCard.label} + ${action.markerCard.label} (‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô ${action.score})`);
      gameState.selectedCards = [action.setIndex, action.markerIndex];
      placeCards();
      break;
      
    case 'discard':
      logMessage(`${playerName} ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏¥‡πâ‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î: ${action.card.label} (‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÑ‡∏°‡πà‡∏î‡∏µ)`);
      gameState.selectedCards = [action.cardIndex];
      discardCard();
      break;
      
    case 'skip':
    default:
      logMessage(`${playerName} ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ç‡πâ‡∏≤‡∏°‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô (‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°)`);
      skipTurn();
      break;
  }
};

// ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
createBoard();
updateDisplay();
enableButtons([]);

</script>
</body>
</html>
