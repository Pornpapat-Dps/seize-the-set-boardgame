<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>üîç Debug ‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background-color: #f5f5f5; 
        }
        .debug-panel { 
            background: white; 
            padding: 20px; 
            border-radius: 8px; 
            margin: 10px 0; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.1); 
        }
        .card-display { 
            display: flex; 
            gap: 10px; 
            margin: 10px 0; 
            flex-wrap: wrap;
        }
        .card { 
            padding: 8px 12px; 
            border: 2px solid #ccc; 
            border-radius: 5px; 
            background: white; 
            cursor: pointer;
            min-width: 100px;
            text-align: center;
        }
        .card.selected { 
            border-color: #007bff; 
            background-color: #e3f2fd; 
        }
        .card.set { border-left: 4px solid #28a745; }
        .card.marker { border-left: 4px solid #dc3545; }
        button { 
            background-color: #007bff; 
            color: white; 
            border: none; 
            padding: 10px 15px; 
            border-radius: 5px; 
            margin: 5px; 
            cursor: pointer; 
        }
        button:hover { background-color: #0056b3; }
        .log { 
            background-color: #f8f9fa; 
            padding: 15px; 
            border-radius: 5px; 
            font-family: monospace; 
            font-size: 12px; 
            max-height: 300px; 
            overflow-y: auto; 
            white-space: pre-wrap;
        }
        .error { color: #dc3545; }
        .success { color: #28a745; }
        .warning { color: #ffc107; }
        h1 { color: #333; text-align: center; }
        h2 { color: #666; }
    </style>
</head>
<body>
    <h1>üîç Debug ‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏´‡∏•‡∏±‡∏á‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</h1>
    
    <div class="debug-panel">
        <h2>üÉè ‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πå‡∏î</h2>
        <p><strong>‡∏Ñ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</strong> (‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏≤‡∏¢‡πÉ‡∏ö)</p>
        <div id="hand" class="card-display"></div>
        <button onclick="addTestCards()">üîÑ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ó‡∏î‡∏™‡∏≠‡∏ö</button>
        <button onclick="clearSelection()">‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</button>
    </div>
    
    <div class="debug-panel">
        <h2>‚öôÔ∏è ‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î</h2>
        <p><strong>‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å:</strong> <span id="selectedInfo">‡πÑ‡∏°‡πà‡∏°‡∏µ</span></p>
        <button onclick="testCardRemoval()">üóëÔ∏è ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î</button>
        <button onclick="testIntersectionEmptySet()">üî• ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Intersection + Empty Set</button>
        <button onclick="testComplementWithSet()">üìê ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Complement + Set</button>
    </div>
    
    <div class="debug-panel">
        <h2>üìä ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</h2>
        <div id="status">
            <strong>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÉ‡∏ô‡∏°‡∏∑‡∏≠:</strong> <span id="cardCount">0</span><br>
            <strong>‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å:</strong> <span id="selectedCount">0</span><br>
            <strong>Index ‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å:</strong> <span id="selectedIndices">[]</span>
        </div>
    </div>
    
    <div class="debug-panel">
        <h2>üìù Log ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</h2>
        <div id="debugLog" class="log">‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ó‡∏î‡∏™‡∏≠‡∏ö...\n</div>
        <button onclick="clearLog()">üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á Log</button>
    </div>

    <script>
        // ‡∏à‡∏≥‡∏•‡∏≠‡∏á gameState
        let mockGameState = {
            selectedCards: [],
            players: {
                black: {
                    hand: []
                }
            },
            currentPlayer: 'black'
        };
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logElement = document.getElementById('debugLog');
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : type === 'warning' ? 'warning' : '';
            logElement.innerHTML += `<span class="${className}">[${timestamp}] ${message}</span>\n`;
            logElement.scrollTop = logElement.scrollHeight;
            console.log(`${type.toUpperCase()}: ${message}`);
        }
        
        function clearLog() {
            document.getElementById('debugLog').innerHTML = 'Log ‡∏ñ‡∏π‡∏Å‡∏•‡πâ‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß...\n';
        }
        
        function updateDisplay() {
            const hand = document.getElementById('hand');
            hand.innerHTML = '';
            
            mockGameState.players.black.hand.forEach((card, index) => {
                const cardElement = document.createElement('div');
                cardElement.className = `card ${card.type}`;
                cardElement.textContent = card.label;
                cardElement.onclick = () => selectCard(index);
                
                if (mockGameState.selectedCards.includes(index)) {
                    cardElement.classList.add('selected');
                }
                
                hand.appendChild(cardElement);
            });
            
            updateStatus();
        }
        
        function updateStatus() {
            document.getElementById('cardCount').textContent = mockGameState.players.black.hand.length;
            document.getElementById('selectedCount').textContent = mockGameState.selectedCards.length;
            document.getElementById('selectedIndices').textContent = JSON.stringify(mockGameState.selectedCards);
            
            const selectedCards = mockGameState.selectedCards.map(index => {
                const card = mockGameState.players.black.hand[index];
                return card ? `${card.label} (${card.type})` : 'undefined';
            });
            document.getElementById('selectedInfo').textContent = selectedCards.join(', ') || '‡πÑ‡∏°‡πà‡∏°‡∏µ';
        }
        
        function selectCard(index) {
            const cardIndex = mockGameState.selectedCards.indexOf(index);
            if (cardIndex === -1) {
                mockGameState.selectedCards.push(index);
                log(`‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡πå‡∏î index ${index}: ${mockGameState.players.black.hand[index]?.label}`, 'info');
            } else {
                mockGameState.selectedCards.splice(cardIndex, 1);
                log(`‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡πå‡∏î index ${index}`, 'info');
            }
            updateDisplay();
        }
        
        function clearSelection() {
            mockGameState.selectedCards = [];
            log('‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î', 'warning');
            updateDisplay();
        }
        
        function addTestCards() {
            mockGameState.players.black.hand = [
                { type: 'set', subtype: 'empty', label: 'Empty Set ‚àÖ', cells: [] },
                { type: 'set', subtype: '2x2', label: 'Set 2x2', cells: ['A1', 'A2', 'B1', 'B2'] },
                { type: 'set', subtype: '4x4', label: 'Set 4x4', cells: ['A1', 'A2', 'A3', 'A4', 'B1', 'B2', 'B3', 'B4', 'C1', 'C2', 'C3', 'C4', 'D1', 'D2', 'D3', 'D4'] },
                { type: 'marker', subtype: 'intersection', label: 'Intersection ‚à©' },
                { type: 'marker', subtype: 'complement', label: 'Complement ·∂ú' },
                { type: 'marker', subtype: 'union', label: 'Union ‚à™' }
            ];
            mockGameState.selectedCards = [];
            log('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ó‡∏î‡∏™‡∏≠‡∏ö 6 ‡πÉ‡∏ö', 'success');
            updateDisplay();
        }
        
        function testCardRemoval() {
            if (mockGameState.selectedCards.length === 0) {
                log('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏ó‡∏î‡∏™‡∏≠‡∏ö', 'error');
                return;
            }
            
            log('üß™ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î', 'info');
            log(`‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏•‡∏ö: ${mockGameState.players.black.hand.length} ‡πÉ‡∏ö`, 'info');
            log(`‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å: ${mockGameState.selectedCards.join(', ')}`, 'info');
            
            // ‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î‡∏à‡∏£‡∏¥‡∏á
            const selectedCards = [...mockGameState.selectedCards];
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏´‡∏≤‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏î‡πâ‡∏ß‡∏¢ find()
            const setIndex = selectedCards.find(i => mockGameState.players.black.hand[i]?.type === 'set');
            const markerIndex = selectedCards.find(i => mockGameState.players.black.hand[i]?.type === 'marker');
            
            log(`setIndex found: ${setIndex}`, setIndex !== undefined ? 'success' : 'error');
            log(`markerIndex found: ${markerIndex}`, markerIndex !== undefined ? 'success' : 'error');
            
            if (setIndex !== undefined && markerIndex !== undefined) {
                const allIndices = [setIndex, markerIndex].sort((a, b) => b - a);
                log(`‡∏à‡∏∞‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î index: ${allIndices.join(', ')} (‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏à‡∏≤‡∏Å‡∏°‡∏≤‡∏Å‡πÑ‡∏õ‡∏ô‡πâ‡∏≠‡∏¢)`, 'info');
                
                allIndices.forEach(index => {
                    const card = mockGameState.players.black.hand[index];
                    if (card) {
                        log(`‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î index ${index}: ${card.label}`, 'success');
                        mockGameState.players.black.hand.splice(index, 1);
                    } else {
                        log(`‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î index ${index}`, 'error');
                    }
                });
            } else {
                log('‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö', 'error');
            }
            
            mockGameState.selectedCards = [];
            log(`‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏´‡∏•‡∏±‡∏á‡∏•‡∏ö: ${mockGameState.players.black.hand.length} ‡πÉ‡∏ö`, 'info');
            updateDisplay();
        }
        
        function testIntersectionEmptySet() {
            // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡πå‡∏î: Empty Set + Intersection
            const emptySetIndex = mockGameState.players.black.hand.findIndex(card => card.subtype === 'empty');
            const intersectionIndex = mockGameState.players.black.hand.findIndex(card => card.subtype === 'intersection');
            
            if (emptySetIndex === -1 || intersectionIndex === -1) {
                log('‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ (Empty Set ‡∏´‡∏£‡∏∑‡∏≠ Intersection)', 'error');
                return;
            }
            
            mockGameState.selectedCards = [emptySetIndex, intersectionIndex];
            log('üî• ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ó‡∏î‡∏™‡∏≠‡∏ö: Empty Set + Intersection', 'warning');
            updateDisplay();
            
            setTimeout(() => {
                testCardRemoval();
            }, 1000);
        }
        
        function testComplementWithSet() {
            // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡πå‡∏î: Set 2x2 + Complement
            const set2x2Index = mockGameState.players.black.hand.findIndex(card => card.subtype === '2x2');
            const complementIndex = mockGameState.players.black.hand.findIndex(card => card.subtype === 'complement');
            
            if (set2x2Index === -1 || complementIndex === -1) {
                log('‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ (Set 2x2 ‡∏´‡∏£‡∏∑‡∏≠ Complement)', 'error');
                return;
            }
            
            mockGameState.selectedCards = [set2x2Index, complementIndex];
            log('üìê ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ó‡∏î‡∏™‡∏≠‡∏ö: Set 2x2 + Complement', 'warning');
            updateDisplay();
            
            setTimeout(() => {
                testCardRemoval();
            }, 1000);
        }
        
        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
        document.addEventListener('DOMContentLoaded', () => {
            log('üîç Debug panel ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô', 'info');
            addTestCards();
        });
    </script>
</body>
</html>